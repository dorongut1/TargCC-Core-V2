// <copyright file="BaseUIGeneratorTests.cs" company="PlaceholderCompany">
// Copyright (c) PlaceholderCompany. All rights reserved.
// </copyright>

namespace TargCC.Core.Tests.Unit.Generators.UI
{
    using System;
    using Microsoft.Extensions.Logging;
    using Moq;
    using TargCC.Core.Generators.UI;
    using TargCC.Core.Interfaces.Models;
    using Xunit;

    /// <summary>
    /// Tests for BaseUIGenerator.
    /// </summary>
    public class BaseUIGeneratorTests
    {
        [Fact]
        public void GetClassName_ValidTableName_ReturnsPascalCase()
        {
            // Arrange
            var tableName = "customer";

            // Act
            var result = TestableGenerator.PublicGetClassName(tableName);

            // Assert
            Assert.Equal("Customer", result);
        }

        [Fact]
        public void GetClassName_WithUnderscores_ReturnsPascalCase()
        {
            // Arrange
            var tableName = "order_item";

            // Act
            var result = TestableGenerator.PublicGetClassName(tableName);

            // Assert
            Assert.Equal("OrderItem", result);
        }

        [Fact]
        public void GetClassName_WithCPrefix_RemovesPrefix()
        {
            // Arrange
            var tableName = "c_customer";

            // Act
            var result = TestableGenerator.PublicGetClassName(tableName);

            // Assert
            Assert.Equal("Customer", result);
        }

        [Theory]
        [InlineData("customer_id", "CustomerId")]
        [InlineData("order_date", "OrderDate")]
        [InlineData("ID", "Id")]
        [InlineData("EmailAddress", "EmailAddress")]
        public void GetPropertyName_ValidNames_ReturnsExpected(string input, string expected)
        {
            // Act
            var result = TestableGenerator.PublicGetPropertyName(input);

            // Assert
            Assert.Equal(expected, result);
        }

        [Theory]
        [InlineData("eno_password", "PasswordHashed")]
        [InlineData("lkp_status", "Status")]
        [InlineData("agg_count", "CountAggregate")]
        [InlineData("scb_approved", "ApprovedChangedBy")]
        public void GetPropertyName_WithPrefixes_HandlesCorrectly(string input, string expected)
        {
            // Act
            var result = TestableGenerator.PublicGetPropertyName(input);

            // Assert
            Assert.Equal(expected, result);
        }

        [Theory]
        [InlineData("eno_password", "ENO", "password")]
        [InlineData("lkp_status", "LKP", "status")]
        [InlineData("customer_id", "", "customer_id")]
        public void SplitPrefix_Various_ReturnsTuple(string input, string expectedPrefix, string expectedBase)
        {
            // Act
            var result = TestableGenerator.PublicSplitPrefix(input);

            // Assert
            Assert.Equal(expectedPrefix, result.prefix);
            Assert.Equal(expectedBase, result.baseName);
        }

        [Theory]
        [InlineData("customer_id", "CustomerId")]
        [InlineData("order item", "OrderItem")]
        [InlineData("product-name", "ProductName")]
        [InlineData("status", "Status")]
        public void ToPascalCase_Various_ReturnsExpected(string input, string expected)
        {
            // Act
            var result = TestableGenerator.PublicToPascalCase(input);

            // Assert
            Assert.Equal(expected, result);
        }

        [Theory]
        [InlineData("CustomerId", "customerId")]
        [InlineData("OrderItem", "orderItem")]
        [InlineData("ID", "id")]
        public void ToCamelCase_Various_ReturnsExpected(string input, string expected)
        {
            // Act
            var result = TestableGenerator.PublicToCamelCase(input);

            // Assert
            Assert.Equal(expected, result);
        }

        [Fact]
        public void GenerateFileHeader_Valid_ContainsTableName()
        {
            // Arrange
            var tableName = "Customer";
            var generatorType = UIGeneratorType.TypeScriptTypes;

            // Act
            var result = TestableGenerator.PublicGenerateFileHeader(tableName, generatorType);

            // Assert
            Assert.Contains("Customer", result);
            Assert.Contains("TypeScriptTypes", result);
            Assert.Contains("<auto-generated>", result);
        }

        [Fact]
        public void Indent_ValidCode_IndentsCorrectly()
        {
            // Arrange
            var code = "line1\nline2\nline3";
            var spaces = 2;

            // Act
            var result = TestableGenerator.PublicIndent(code, spaces);

            // Assert
            Assert.Contains("  line1", result);
            Assert.Contains("  line2", result);
            Assert.Contains("  line3", result);
        }

        [Theory]
        [InlineData("AddedBy", true)]
        [InlineData("AddedOn", true)]
        [InlineData("ChangedBy", true)]
        [InlineData("ChangedOn", true)]
        [InlineData("CustomerId", false)]
        [InlineData("Name", false)]
        public void IsAuditField_Various_ReturnsExpected(string columnName, bool expected)
        {
            // Act
            var result = TestableGenerator.PublicIsAuditField(columnName);

            // Assert
            Assert.Equal(expected, result);
        }

        // Testable wrapper class to expose protected methods
        private class TestableGenerator : BaseUIGenerator
        {
            public TestableGenerator()
                : base(new Mock<ILogger>().Object)
            {
            }

            public override UIGeneratorType GeneratorType => UIGeneratorType.TypeScriptTypes;

            public override Task<string> GenerateAsync(Table table, DatabaseSchema schema, UIGeneratorConfig config)
            {
                throw new NotImplementedException();
            }

            public static string PublicGetClassName(string tableName) => GetClassName(tableName);

            public static string PublicGetPropertyName(string columnName) => GetPropertyName(columnName);

            public static (string prefix, string baseName) PublicSplitPrefix(string columnName) => SplitPrefix(columnName);

            public static string PublicToPascalCase(string input) => ToPascalCase(input);

            public static string PublicToCamelCase(string input) => ToCamelCase(input);

            public static string PublicGenerateFileHeader(string tableName, UIGeneratorType generatorType) =>
                GenerateFileHeader(tableName, generatorType);

            public static string PublicIndent(string code, int spaces) => Indent(code, spaces);

            public static bool PublicIsAuditField(string columnName) => IsAuditField(columnName);
        }
    }
}
