// <auto-generated>
//     This code was generated by TargCC
//     Generated for: NewCardRequestAPI (Handler)
//     Generation date: 2025-12-17 21:37:04
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

using MediatR;
using Microsoft.Extensions.Logging;
using UpayCard.RiskManagement.Application.Common.Models;
using UpayCard.RiskManagement.Domain.Entities;
using UpayCard.RiskManagement.Domain.Interfaces;

namespace UpayCard.RiskManagement.Application.Features.NewCardRequestAPIs.Commands;

/// <summary>
/// Handles the CreateNewCardRequestAPICommand request.
/// </summary>
public class CreateNewCardRequestAPIHandler : IRequestHandler<CreateNewCardRequestAPICommand, Result<long>>
{
    private readonly INewCardRequestAPIRepository _repository;
    private readonly ILogger<CreateNewCardRequestAPIHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="CreateNewCardRequestAPIHandler"/> class.
    /// </summary>
    public CreateNewCardRequestAPIHandler(
        INewCardRequestAPIRepository repository,
        ILogger<CreateNewCardRequestAPIHandler> logger)
    {
        _repository = repository ?? throw new ArgumentNullException(nameof(repository));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async Task<Result<long>> Handle(CreateNewCardRequestAPICommand request, CancellationToken cancellationToken)
    {
        ArgumentNullException.ThrowIfNull(request);

        _logger.LogDebug("Creating new NewCardRequestAPI");

        try
        {
            var entity = new NewCardRequestAPI
            {
                TableName_NewCardRequestAPI = request.TableName_NewCardRequestAPI,
                FirstName = request.FirstName,
                LastName = request.LastName,
                FirstNameLatin = request.FirstNameLatin,
                LastNameLatin = request.LastNameLatin,
                email = request.email,
                BirthDate = request.BirthDate,
                IsraelIDNumber = request.IsraelIDNumber,
                lkpPassportCountry_Country = request.lkpPassportCountry_Country,
                PassportNumber = request.PassportNumber,
                DateIssued = request.DateIssued,
                ExpiryDate = request.ExpiryDate,
                CellphoneNumber = request.CellphoneNumber,
                HomePhoneNumber = request.HomePhoneNumber,
                ActualAddressNumber = request.ActualAddressNumber,
                ActualAddressStreet = request.ActualAddressStreet,
                ActualAddressCity = request.ActualAddressCity,
                ActualZipCode = request.ActualZipCode,
                MailAddressNumber = request.MailAddressNumber,
                MailAddressStreet = request.MailAddressStreet,
                MailAddressCity = request.MailAddressCity,
                MailZipCode = request.MailZipCode,
                Profession = request.Profession,
                lkpEmploymentStatus = request.lkpEmploymentStatus,
                Employer = request.Employer,
                lkpCardUse = request.lkpCardUse,
                PublicPosition = request.PublicPosition,
                ConnectionWithPublicPerson = request.ConnectionWithPublicPerson,
                lkpAdditionalCitizenship_Country = request.lkpAdditionalCitizenship_Country,
                lkpConnectionWithIsrael = request.lkpConnectionWithIsrael,
                ConnectionWithIsraelDetails = request.ConnectionWithIsraelDetails,
                lkpMainUseOfCard_CardUsage = request.lkpMainUseOfCard_CardUsage,
                IsExpectedToReceiveDeposits = request.IsExpectedToReceiveDeposits,
                IsExpectedToReceiveDepositsDetails = request.IsExpectedToReceiveDepositsDetails,
                WasPreviouslyDeniedBankService = request.WasPreviouslyDeniedBankService,
                WitnessFirstName = request.WitnessFirstName,
                WitnessLastName = request.WitnessLastName,
                WitnessIsraelID = request.WitnessIsraelID,
                InitialLoad = request.InitialLoad,
                CustomerReference = request.CustomerReference,
                UpdatingLoginID = request.UpdatingLoginID,
                AmountIncludesLoadFee = request.AmountIncludesLoadFee,
                CardAllocationFee = request.CardAllocationFee,
                MessageIdentifier = request.MessageIdentifier,
                IDFrontURL = request.IDFrontURL,
                IDBackURL = request.IDBackURL,
                IDAppendixURL = request.IDAppendixURL,
                PassportURL = request.PassportURL
            };

            await _repository.AddAsync(entity, cancellationToken);

            _logger.LogInformation("NewCardRequestAPI created successfully with ID: {Id}", entity.ID);

            return Result<long>.Success(entity.ID);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error creating NewCardRequestAPI");
            throw;
        }
    }
}
