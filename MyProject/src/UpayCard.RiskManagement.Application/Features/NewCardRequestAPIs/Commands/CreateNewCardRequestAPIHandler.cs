// <auto-generated>
//     This code was generated by TargCC
//     Generated for: NewCardRequestAPI (Handler)
//     Generation date: 2025-12-15 22:18:52
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

using MediatR;
using Microsoft.Extensions.Logging;
using TargCC.Application.Common.Models;
using TargCC.Domain.Entities;
using TargCC.Domain.Interfaces;

namespace TargCC.Application.Features.NewCardRequestAPIs.Commands;

/// <summary>
/// Handles the CreateNewCardRequestAPICommand request.
/// </summary>
public class CreateNewCardRequestAPIHandler : IRequestHandler<CreateNewCardRequestAPICommand, Result<int>>
{
    private readonly INewCardRequestAPIRepository _repository;
    private readonly ILogger<CreateNewCardRequestAPIHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="CreateNewCardRequestAPIHandler"/> class.
    /// </summary>
    public CreateNewCardRequestAPIHandler(
        INewCardRequestAPIRepository repository,
        ILogger<CreateNewCardRequestAPIHandler> logger)
    {
        _repository = repository ?? throw new ArgumentNullException(nameof(repository));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async Task<Result<int>> Handle(CreateNewCardRequestAPICommand request, CancellationToken cancellationToken)
    {
        ArgumentNullException.ThrowIfNull(request);

        _logger.LogDebug("Creating new NewCardRequestAPI");

        try
        {
            var entity = new NewCardRequestAPI
            {
                TableName_NewCardRequestAPI = request.TableName_NewCardRequestAPI,
                enmRequestedCurrency_Currency = request.enmRequestedCurrency_Currency,
                FirstName = request.FirstName,
                LastName = request.LastName,
                FirstNameLatin = request.FirstNameLatin,
                LastNameLatin = request.LastNameLatin,
                email = request.email,
                BirthDate = request.BirthDate,
                IsraelIDNumber = request.IsraelIDNumber,
                lkpPassportCountry_Country = request.lkpPassportCountry_Country,
                PassportNumber = request.PassportNumber,
                DateIssued = request.DateIssued,
                ExpiryDate = request.ExpiryDate,
                CellphoneNumber = request.CellphoneNumber,
                HomePhoneNumber = request.HomePhoneNumber,
                ActualAddressNumber = request.ActualAddressNumber,
                ActualAddressStreet = request.ActualAddressStreet,
                ActualAddressCity = request.ActualAddressCity,
                ActualZipCode = request.ActualZipCode,
                MailAddressNumber = request.MailAddressNumber,
                MailAddressStreet = request.MailAddressStreet,
                MailAddressCity = request.MailAddressCity,
                MailZipCode = request.MailZipCode,
                enmGender = request.enmGender,
                enmLanguage = request.enmLanguage,
                enmMessagingMode = request.enmMessagingMode,
                Profession = request.Profession,
                lkpEmploymentStatus = request.lkpEmploymentStatus,
                Employer = request.Employer,
                lkpCardUse = request.lkpCardUse,
                PublicPosition = request.PublicPosition,
                ConnectionWithPublicPerson = request.ConnectionWithPublicPerson,
                lkpAdditionalCitizenship_Country = request.lkpAdditionalCitizenship_Country,
                lkpConnectionWithIsrael = request.lkpConnectionWithIsrael,
                ConnectionWithIsraelDetails = request.ConnectionWithIsraelDetails,
                lkpMainUseOfCard_CardUsage = request.lkpMainUseOfCard_CardUsage,
                IsExpectedToReceiveDeposits = request.IsExpectedToReceiveDeposits,
                IsExpectedToReceiveDepositsDetails = request.IsExpectedToReceiveDepositsDetails,
                WasPreviouslyDeniedBankService = request.WasPreviouslyDeniedBankService,
                WitnessFirstName = request.WitnessFirstName,
                WitnessLastName = request.WitnessLastName,
                WitnessIsraelID = request.WitnessIsraelID,
                enmIdentificationMethod = request.enmIdentificationMethod,
                InitialLoad = request.InitialLoad,
                enmInitialLoadMethod_LoadMethod = request.enmInitialLoadMethod_LoadMethod,
                CustomerReference = request.CustomerReference,
                AddedBy = request.AddedBy,
                AddedOn = request.AddedOn,
                ChangedBy = request.ChangedBy,
                ChangedOn = request.ChangedOn,
                UpdatingLoginID = request.UpdatingLoginID,
                AmountIncludesLoadFee = request.AmountIncludesLoadFee,
                CardAllocationFee = request.CardAllocationFee,
                MessageIdentifier = request.MessageIdentifier,
                IDFrontURL = request.IDFrontURL,
                IDBackURL = request.IDBackURL,
                IDAppendixURL = request.IDAppendixURL,
                PassportURL = request.PassportURL,
                Comments = request.Comments,
                TZFront = request.TZFront,
                TZBack = request.TZBack,
                Passport = request.Passport
            };

            await _repository.AddAsync(entity, cancellationToken);

            _logger.LogInformation("NewCardRequestAPI created successfully with ID: {Id}", entity.Id);

            return Result<int>.Success(entity.Id);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error creating NewCardRequestAPI");
            throw;
        }
    }
}
