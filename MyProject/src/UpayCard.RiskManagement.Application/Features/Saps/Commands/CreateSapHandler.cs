// <auto-generated>
//     This code was generated by TargCC
//     Generated for: SAP (Handler)
//     Generation date: 2025-12-17 21:37:04
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

using MediatR;
using Microsoft.Extensions.Logging;
using UpayCard.RiskManagement.Application.Common.Models;
using UpayCard.RiskManagement.Domain.Entities;
using UpayCard.RiskManagement.Domain.Interfaces;

namespace UpayCard.RiskManagement.Application.Features.Saps.Commands;

/// <summary>
/// Handles the CreateSapCommand request.
/// </summary>
public class CreateSapHandler : IRequestHandler<CreateSapCommand, Result<bool>>
{
    private readonly ISapRepository _repository;
    private readonly ILogger<CreateSapHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="CreateSapHandler"/> class.
    /// </summary>
    public CreateSapHandler(
        ISapRepository repository,
        ILogger<CreateSapHandler> logger)
    {
        _repository = repository ?? throw new ArgumentNullException(nameof(repository));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async Task<Result<bool>> Handle(CreateSapCommand request, CancellationToken cancellationToken)
    {
        ArgumentNullException.ThrowIfNull(request);

        _logger.LogDebug("Creating new SAP");

        try
        {
            var entity = new Sap
            {
                TableName_SAP = request.TableName_SAP,
                CustomerAccountPrefix = request.CustomerAccountPrefix,
                CardFileLocation = request.CardFileLocation,
                DistributorCCCreditAccountPrefix = request.DistributorCCCreditAccountPrefix,
                DistributorCCCreditCommissionAccountPrefix = request.DistributorCCCreditCommissionAccountPrefix,
                DistributorCCDeditAccountPrefix = request.DistributorCCDeditAccountPrefix,
                ClientCardMonthlyFeeAccount = request.ClientCardMonthlyFeeAccount,
                ClientCHBFeeAccount = request.ClientCHBFeeAccount,
                ClientCreditCardDebitFeeAccount = request.ClientCreditCardDebitFeeAccount,
                ClientDeliveryFeeAccount = request.ClientDeliveryFeeAccount,
                ClientDocumentionRequestFeeAccount = request.ClientDocumentionRequestFeeAccount,
                ClientLoadFeeAccount = request.ClientLoadFeeAccount,
                ClientNewCardFeeAccount = request.ClientNewCardFeeAccount,
                ClientPurchaseFromChangeFeeAccount = request.ClientPurchaseFromChangeFeeAccount,
                ClientReplacementCardFeeAccount = request.ClientReplacementCardFeeAccount,
                InvoiceReceiptFileLocation = request.InvoiceReceiptFileLocation,
                TransactionFileLocation = request.TransactionFileLocation,
                TransactionSwitchoverHour = request.TransactionSwitchoverHour,
                UpdatingLoginID = request.UpdatingLoginID,
                BankBusinessSAPAccount = request.BankBusinessSAPAccount,
                ClientCreditCardPaymentsInterestAccount = request.ClientCreditCardPaymentsInterestAccount,
                ClientBankWithdrawalFeeAccount = request.ClientBankWithdrawalFeeAccount,
                ClientInterWalletTransferFeeAccount = request.ClientInterWalletTransferFeeAccount,
                ClientBitDebitFeeAccount = request.ClientBitDebitFeeAccount,
                ClientBankDepositFeeAccount = request.ClientBankDepositFeeAccount,
                ClientCreditCardCreditFeeAccount = request.ClientCreditCardCreditFeeAccount,
                DistributorCashCreditToChangerAccountPrefix = request.DistributorCashCreditToChangerAccountPrefix,
                DistributorCashCreditCommissionAccountPrefix = request.DistributorCashCreditCommissionAccountPrefix,
                DistributorCashDeditFromChangerAccountPrefix = request.DistributorCashDeditFromChangerAccountPrefix,
                BankPrivateSAPAccount = request.BankPrivateSAPAccount,
                SAPICPAccountForLeumiCashWithdrawalFee = request.SAPICPAccountForLeumiCashWithdrawalFee,
                DistributorOrderCardsFee = request.DistributorOrderCardsFee,
                DistributorCCDebitAccountPrefix = request.DistributorCCDebitAccountPrefix
            };

            await _repository.AddAsync(entity, cancellationToken);

            _logger.LogInformation("SAP created successfully with ID: {Id}", entity.TableName_SAP);

            return Result<bool>.Success(entity.TableName_SAP);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error creating SAP");
            throw;
        }
    }
}
