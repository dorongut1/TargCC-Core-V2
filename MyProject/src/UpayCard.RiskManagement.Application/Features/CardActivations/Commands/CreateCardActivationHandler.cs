// <auto-generated>
//     This code was generated by TargCC
//     Generated for: CardActivation (Handler)
//     Generation date: 2025-12-18 07:30:15
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

using MediatR;
using Microsoft.Extensions.Logging;
using UpayCard.RiskManagement.Application.Common.Models;
using UpayCard.RiskManagement.Domain.Entities;
using UpayCard.RiskManagement.Domain.Interfaces;

namespace UpayCard.RiskManagement.Application.Features.CardActivations.Commands;

/// <summary>
/// Handles the CreateCardActivationCommand request.
/// </summary>
public class CreateCardActivationHandler : IRequestHandler<CreateCardActivationCommand, Result<long>>
{
    private readonly ICardActivationRepository _repository;
    private readonly ILogger<CreateCardActivationHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="CreateCardActivationHandler"/> class.
    /// </summary>
    public CreateCardActivationHandler(
        ICardActivationRepository repository,
        ILogger<CreateCardActivationHandler> logger)
    {
        _repository = repository ?? throw new ArgumentNullException(nameof(repository));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async Task<Result<long>> Handle(CreateCardActivationCommand request, CancellationToken cancellationToken)
    {
        ArgumentNullException.ThrowIfNull(request);

        _logger.LogDebug("Creating new CardActivation");

        try
        {
            var entity = new CardActivation
            {
                TableName_CardActivation = request.TableName_CardActivation,
                DistributorID = request.DistributorID,
                CustomerID = request.CustomerID,
                CardID = request.CardID,
                Profession = request.Profession,
                lkpEmploymentStatus = request.lkpEmploymentStatus,
                Employer = request.Employer,
                lkpCardUse = request.lkpCardUse,
                PublicPosition = request.PublicPosition,
                ConnectionWithPublicPerson = request.ConnectionWithPublicPerson,
                lkpAdditionalCitizenship_Country = request.lkpAdditionalCitizenship_Country,
                lkpConnectionWithIsrael = request.lkpConnectionWithIsrael,
                ConnectionWithIsraelDetails = request.ConnectionWithIsraelDetails,
                lkpMainUseOfCard_CardUsage = request.lkpMainUseOfCard_CardUsage,
                IsExpectedToReceiveDeposits = request.IsExpectedToReceiveDeposits,
                IsExpectedToReceiveDepositsDetails = request.IsExpectedToReceiveDepositsDetails,
                WasPreviouslyDeniedBankService = request.WasPreviouslyDeniedBankService,
                WitnessFirstName = request.WitnessFirstName,
                WitnessLastName = request.WitnessLastName,
                WitnessIsraelID = request.WitnessIsraelID,
                ResponseCode = request.ResponseCode,
                ResponseText = request.ResponseText,
                LoggedAlertID = request.LoggedAlertID,
                WhenRequested = request.WhenRequested,
                WhenResponded = request.WhenResponded,
                InitialLoadID = request.InitialLoadID,
                DocumentionLoadDate = request.DocumentionLoadDate,
                lgInterviewedByUser = request.lgInterviewedByUser,
                DeletedBy = request.DeletedBy,
                DeletedOn = request.DeletedOn,
                UpdatingLoginID = request.UpdatingLoginID,
                lgAddedBy = request.lgAddedBy,
                logCellPhone = request.logCellPhone,
                WantsNameOnCard = request.WantsNameOnCard,
                CardClubID = request.CardClubID,
                CreatingApp = request.CreatingApp,
                RequestedInitialLoad = request.RequestedInitialLoad
            };

            await _repository.AddAsync(entity, cancellationToken);

            _logger.LogInformation("CardActivation created successfully with ID: {Id}", entity.ID);

            return Result<long>.Success(entity.ID);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error creating CardActivation");
            throw;
        }
    }
}
