// <auto-generated>
//     This code was generated by TargCC.Core.Generators v2.0
//     Generated from table: dbo.TransactionLoad
//     Generation date: 2025-12-17 08:54:26
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

namespace UpayCard.RiskManagement.Infrastructure.Repositories;

using System.Data;
using System.Threading;
using System.Threading.Tasks;
using Dapper;
using Microsoft.Extensions.Logging;
using UpayCard.RiskManagement.Domain.Entities;
using UpayCard.RiskManagement.Domain.Interfaces;

/// <summary>
/// Repository implementation for TransactionLoad entity data access operations.
/// </summary>
/// <remarks>
/// <para>
/// This repository provides data access for the TransactionLoad entity using Dapper
/// for stored procedure calls. All operations are async and support cancellation.
/// </para>
/// </remarks>
public class TransactionLoadRepository : ITransactionLoadRepository
{
    private readonly IDbConnection _connection;
    private readonly ILogger<TransactionLoadRepository> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="TransactionLoadRepository"/> class.
    /// </summary>
    /// <param name="connection">Database connection for Dapper operations.</param>
    /// <param name="logger">Logger for tracking repository operations.</param>
    public TransactionLoadRepository(IDbConnection connection, ILogger<TransactionLoadRepository> logger)
    {
        _connection = connection ?? throw new ArgumentNullException(nameof(connection));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<TransactionLoad?> GetByIdAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by ID: {Id}", id);

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<TransactionLoad>(
                "SP_GetTransactionLoadByID",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("TransactionLoad found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetAllAsync(int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting all TransactionLoad entities. Skip: {Skip}, Take: {Take}", skip, take);

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetAllTransactionLoads",
                new { Skip = skip, Take = take },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting all TransactionLoad entities");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetFilteredAsync(long? requestedTransactionID = null, DateTime? day = null, long? distributorID = null, string? customerReference = null, decimal? amount = null, long? cardID = null, string? enmLoadType = null, string? enmLoadResult = null, string? enmCurrency = null, long? customerID = null, int? faultNo = null, long? loggedAlertID = null, DateTime? month = null, long? userID = null, DateTimeOffset? whenRequested = null, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting filtered TransactionLoad entities");

        try
        {
            var parameters = new {
                RequestedTransactionID = requestedTransactionID,
                clc_Day = day,
                DistributorID = distributorID,
                CustomerReference = customerReference,
                Amount = amount,
                CardID = cardID,
                enmLoadType = enmLoadType,
                enmLoadResult = enmLoadResult,
                enmCurrency = enmCurrency,
                CustomerID = customerID,
                FaultNo = faultNo,
                LoggedAlertID = loggedAlertID,
                clc_Month = month,
                UserID = userID,
                WhenRequested = whenRequested,
                Skip = skip,
                Take = take
            };

            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetFilteredTransactionLoads",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} filtered TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting filtered TransactionLoad entities");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task AddAsync(TransactionLoad entity, CancellationToken cancellationToken = default)
    {
        if (entity == null)
        {
            throw new ArgumentNullException(nameof(entity));
        }

        _logger.LogDebug("Adding new TransactionLoad");

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@TableName_TransactionLoad", entity.TableName_TransactionLoad);
            parameters.Add("@UserID", entity.UserID);
            parameters.Add("@DistributorID", entity.DistributorID);
            parameters.Add("@enmLoadType", entity.enmLoadType);
            parameters.Add("@CustomerID", entity.CustomerID);
            parameters.Add("@CardID", entity.CardID);
            parameters.Add("@enmCurrency", entity.enmCurrency);
            parameters.Add("@Amount", entity.Amount);
            parameters.Add("@WhenRequested", entity.WhenRequested);
            parameters.Add("@ExchangeRateUsed", entity.ExchangeRateUsed);
            parameters.Add("@AmountInILS", entity.AmountInILS);
            parameters.Add("@PaymentDebitResult", entity.PaymentDebitResult);
            parameters.Add("@PaymentDebitAuthorizationCode", entity.PaymentDebitAuthorizationCode);
            parameters.Add("@PaymentDebitDetails", entity.PaymentDebitDetails);
            parameters.Add("@DebitElapsedTimeSec", entity.DebitElapsedTimeSec);
            parameters.Add("@enmLoadApproved_ApprovalType", entity.enmLoadApproved_ApprovalType);
            parameters.Add("@LoadResponseCode", entity.LoadResponseCode);
            parameters.Add("@LoadResponse", entity.LoadResponse);
            parameters.Add("@LoadElapsedTimeSec", entity.LoadElapsedTimeSec);
            parameters.Add("@PaymentCreditResult", entity.PaymentCreditResult);
            parameters.Add("@PaymentCreditAuthorizationCode", entity.PaymentCreditAuthorizationCode);
            parameters.Add("@PaymentCreditDetails", entity.PaymentCreditDetails);
            parameters.Add("@CreditElapsedTimeSec", entity.CreditElapsedTimeSec);
            parameters.Add("@LoggedAlertID", entity.LoggedAlertID);
            parameters.Add("@FaultNo", entity.FaultNo);
            parameters.Add("@enmLoadResult", entity.enmLoadResult);
            parameters.Add("@DeletedBy", entity.DeletedBy);
            parameters.Add("@DeletedOn", entity.DeletedOn);
            parameters.Add("@UpdatingLoginID", entity.UpdatingLoginID);
            parameters.Add("@enmCoveredBy", entity.enmCoveredBy);
            parameters.Add("@Details", entity.Details);
            parameters.Add("@CustomerReference", entity.CustomerReference);
            parameters.Add("@RepresentativeExchangeRate", entity.RepresentativeExchangeRate);
            parameters.Add("@RequestedTransactionID", entity.RequestedTransactionID);
            parameters.Add("@AddedBy", entity.AddedBy);

            await _connection.ExecuteAsync(
                "SP_AddTransactionLoad",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("TransactionLoad added successfully");
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error adding TransactionLoad");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task UpdateAsync(TransactionLoad entity, CancellationToken cancellationToken = default)
    {
        if (entity == null)
        {
            throw new ArgumentNullException(nameof(entity));
        }

        _logger.LogDebug("Updating TransactionLoad with ID: {Id}", entity.ID);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", entity.ID);
            parameters.Add("@TableName_TransactionLoad", entity.TableName_TransactionLoad);
            parameters.Add("@UserID", entity.UserID);
            parameters.Add("@DistributorID", entity.DistributorID);
            parameters.Add("@enmLoadType", entity.enmLoadType);
            parameters.Add("@CustomerID", entity.CustomerID);
            parameters.Add("@CardID", entity.CardID);
            parameters.Add("@enmCurrency", entity.enmCurrency);
            parameters.Add("@Amount", entity.Amount);
            parameters.Add("@WhenRequested", entity.WhenRequested);
            parameters.Add("@ExchangeRateUsed", entity.ExchangeRateUsed);
            parameters.Add("@AmountInILS", entity.AmountInILS);
            parameters.Add("@PaymentDebitResult", entity.PaymentDebitResult);
            parameters.Add("@PaymentDebitAuthorizationCode", entity.PaymentDebitAuthorizationCode);
            parameters.Add("@PaymentDebitDetails", entity.PaymentDebitDetails);
            parameters.Add("@DebitElapsedTimeSec", entity.DebitElapsedTimeSec);
            parameters.Add("@enmLoadApproved_ApprovalType", entity.enmLoadApproved_ApprovalType);
            parameters.Add("@LoadResponseCode", entity.LoadResponseCode);
            parameters.Add("@LoadResponse", entity.LoadResponse);
            parameters.Add("@LoadElapsedTimeSec", entity.LoadElapsedTimeSec);
            parameters.Add("@PaymentCreditResult", entity.PaymentCreditResult);
            parameters.Add("@PaymentCreditAuthorizationCode", entity.PaymentCreditAuthorizationCode);
            parameters.Add("@PaymentCreditDetails", entity.PaymentCreditDetails);
            parameters.Add("@CreditElapsedTimeSec", entity.CreditElapsedTimeSec);
            parameters.Add("@LoggedAlertID", entity.LoggedAlertID);
            parameters.Add("@FaultNo", entity.FaultNo);
            parameters.Add("@enmLoadResult", entity.enmLoadResult);
            parameters.Add("@DeletedBy", entity.DeletedBy);
            parameters.Add("@DeletedOn", entity.DeletedOn);
            parameters.Add("@UpdatingLoginID", entity.UpdatingLoginID);
            parameters.Add("@enmCoveredBy", entity.enmCoveredBy);
            parameters.Add("@Details", entity.Details);
            parameters.Add("@CustomerReference", entity.CustomerReference);
            parameters.Add("@RepresentativeExchangeRate", entity.RepresentativeExchangeRate);
            parameters.Add("@RequestedTransactionID", entity.RequestedTransactionID);
            parameters.Add("@ChangedBy", entity.ChangedBy);

            await _connection.ExecuteAsync(
                "SP_UpdateTransactionLoad",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("TransactionLoad updated successfully. ID: {Id}", entity.ID);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error updating TransactionLoad with ID: {Id}", entity.ID);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task DeleteAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Deleting TransactionLoad with ID: {Id}", id);

        try
        {
            await _connection.ExecuteAsync(
                "SP_DeleteTransactionLoad",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("TransactionLoad deleted successfully. ID: {Id}", id);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error deleting TransactionLoad with ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<TransactionLoad?> GetByRequestedTransactionIDAsync(long requestedTransactionID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by RequestedTransactionID");

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<TransactionLoad>(
                "SP_GetTransactionLoadByRequestedTransactionID",
                new { RequestedTransactionID = requestedTransactionID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("TransactionLoad found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by RequestedTransactionID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByDayAsync(DateTime day, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by clc_Day");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByDay",
                new { Day = day },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by clc_Day");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByDistributorIDAndCustomerReferenceAsync(long distributorID, string customerReference, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by DistributorID, CustomerReference");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByDistributorIDAndCustomerReference",
                new { DistributorID = distributorID, CustomerReference = customerReference },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by DistributorID, CustomerReference");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByAmountAsync(decimal amount, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by Amount");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByAmount",
                new { Amount = amount },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by Amount");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByCardIDAsync(long cardID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by CardID");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByCardID",
                new { CardID = cardID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by CardID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByCardIDAndenmLoadTypeAndenmLoadResultAsync(long cardID, string enmLoadType, string enmLoadResult, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by CardID, enmLoadType, enmLoadResult");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByCardIDAndenmLoadTypeAndenmLoadResult",
                new { CardID = cardID, enmLoadType = enmLoadType, enmLoadResult = enmLoadResult },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by CardID, enmLoadType, enmLoadResult");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByenmCurrencyAsync(string enmCurrency, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by enmCurrency");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByenmCurrency",
                new { enmCurrency = enmCurrency },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by enmCurrency");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByCustomerIDAsync(long customerID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by CustomerID");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByCustomerID",
                new { CustomerID = customerID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by CustomerID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByDistributorIDAsync(long distributorID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by DistributorID");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByDistributorID",
                new { DistributorID = distributorID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by DistributorID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByFaultNoAsync(int faultNo, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by FaultNo");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByFaultNo",
                new { FaultNo = faultNo },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by FaultNo");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByenmLoadResultAsync(string enmLoadResult, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by enmLoadResult");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByenmLoadResult",
                new { enmLoadResult = enmLoadResult },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by enmLoadResult");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByenmLoadTypeAsync(string enmLoadType, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by enmLoadType");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByenmLoadType",
                new { enmLoadType = enmLoadType },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by enmLoadType");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByLoggedAlertIDAsync(long loggedAlertID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by LoggedAlertID");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByLoggedAlertID",
                new { LoggedAlertID = loggedAlertID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by LoggedAlertID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByMonthAsync(DateTime month, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by clc_Month");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByMonth",
                new { Month = month },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by clc_Month");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByUserIDAsync(long userID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by UserID");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByUserID",
                new { UserID = userID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by UserID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetByWhenRequestedAsync(DateTimeOffset whenRequested, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting TransactionLoad by WhenRequested");

        try
        {
            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetTransactionLoadByWhenRequested",
                new { WhenRequested = whenRequested },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} TransactionLoad entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting TransactionLoad by WhenRequested");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<BackofficeTransaction>> GetBackofficeTransactionsAsync(long transactionLoadId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching BACKOFFICETRANSACTIONS for TransactionLoad ID: {TransactionLoadId}", transactionLoadId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", transactionLoadId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<BackofficeTransaction>(
                "SP_GetTransactionLoadBackofficeTransactions",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} BACKOFFICETRANSACTIONS for TransactionLoad ID: {TransactionLoadId}", result.Count(), transactionLoadId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching BACKOFFICETRANSACTIONS for TransactionLoad ID: {TransactionLoadId}", transactionLoadId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<CardActivation>> GetCardActivationsAsync(long transactionLoadId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching CARDACTIVATIONS for TransactionLoad ID: {TransactionLoadId}", transactionLoadId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", transactionLoadId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<CardActivation>(
                "SP_GetTransactionLoadCardActivations",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} CARDACTIVATIONS for TransactionLoad ID: {TransactionLoadId}", result.Count(), transactionLoadId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching CARDACTIVATIONS for TransactionLoad ID: {TransactionLoadId}", transactionLoadId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<ImportTransactionLoadRow>> GetImportTransactionLoadRowsAsync(long transactionLoadId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching IMPORTTRANSACTIONLOADROWS for TransactionLoad ID: {TransactionLoadId}", transactionLoadId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", transactionLoadId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<ImportTransactionLoadRow>(
                "SP_GetTransactionLoadImportTransactionLoadRows",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} IMPORTTRANSACTIONLOADROWS for TransactionLoad ID: {TransactionLoadId}", result.Count(), transactionLoadId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching IMPORTTRANSACTIONLOADROWS for TransactionLoad ID: {TransactionLoadId}", transactionLoadId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<bool> ExistsAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Checking if TransactionLoad exists with ID: {Id}", id);

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<TransactionLoad>(
                "SP_GetTransactionLoadByID",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            bool exists = result != null;
            _logger.LogDebug("TransactionLoad exists: {Exists}", exists);
            return exists;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error checking if TransactionLoad exists. ID: {Id}", id);
            throw;
        }
    }
}
