// <auto-generated>
//     This code was generated by TargCC.Core.Generators v2.0
//     Generated from table: dbo.NewCardRequest
//     Generation date: 2025-12-11 11:52:13
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

namespace UpayCard.RiskManagement.Infrastructure.Repositories;

using System.Data;
using Dapper;
using Microsoft.Extensions.Logging;
using UpayCard.RiskManagement.Domain.Entities;
using UpayCard.RiskManagement.Domain.Interfaces;

/// <summary>
/// Repository implementation for NewCardRequest entity data access operations.
/// </summary>
/// <remarks>
/// <para>
/// This repository provides data access for the NewCardRequest entity using Dapper
/// for stored procedure calls. All operations are async and support cancellation.
/// </para>
/// </remarks>
public class NewCardRequestRepository : INewCardRequestRepository
{
    private readonly IDbConnection _connection;
    private readonly ILogger<NewCardRequestRepository> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="NewCardRequestRepository"/> class.
    /// </summary>
    /// <param name="connection">Database connection for Dapper operations.</param>
    /// <param name="logger">Logger for tracking repository operations.</param>
    public NewCardRequestRepository(IDbConnection connection, ILogger<NewCardRequestRepository> logger)
    {
        _connection = connection ?? throw new ArgumentNullException(nameof(connection));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async Task<NewCardRequest?> GetByIdAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by ID: {Id}", id);

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<NewCardRequest>(
                "SP_GetNewCardRequestByID",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("NewCardRequest found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetAllAsync(int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting all NewCardRequest entities. Skip: {Skip}, Take: {Take}", skip, take);

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetAllNewCardRequests",
                new { Skip = skip, Take = take },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting all NewCardRequest entities");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetFilteredAsync(long? newCardRequestAPIID = null, long? cardActivationID = null, long? intendedClubID = null, long? newCardRequestAPILoggedAlertID = null, long? customerID = null, long? distributorSentToID = null, string? firstName = null, string? israelIDNumber = null, string? lkpPassportCountry_Country = null, string? passportNumber = null, string? lastName = null, string? enmLastStatusBeforeCancel_CardRequestStatus = null, string? enmReceiptMethod = null, string? enmCardRequestStatus = null, DateTimeOffset? whenStatusChanged = null, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting filtered NewCardRequest entities");

        try
        {
            var parameters = new {
                blg_NewCardRequestAPIID = newCardRequestAPIID,
                CardActivationID = cardActivationID,
                IntendedClubID = intendedClubID,
                clc_NewCardRequestAPILoggedAlertID = newCardRequestAPILoggedAlertID,
                CustomerID = customerID,
                DistributorSentToID = distributorSentToID,
                FirstName = firstName,
                IsraelIDNumber = israelIDNumber,
                lkpPassportCountry_Country = lkpPassportCountry_Country,
                PassportNumber = passportNumber,
                LastName = lastName,
                enmLastStatusBeforeCancel_CardRequestStatus = enmLastStatusBeforeCancel_CardRequestStatus,
                enmReceiptMethod = enmReceiptMethod,
                spt_enmCardRequestStatus = enmCardRequestStatus,
                clc_WhenStatusChanged = whenStatusChanged,
                Skip = skip,
                Take = take
            };

            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetFilteredNewCardRequests",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} filtered NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting filtered NewCardRequest entities");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task AddAsync(NewCardRequest entity, CancellationToken cancellationToken = default)
    {
        if (entity == null)
        {
            throw new ArgumentNullException(nameof(entity));
        }

        _logger.LogDebug("Adding new NewCardRequest");

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@TableName_NewCardRequest", entity.TableName_NewCardRequest);
            parameters.Add("@enmCurrency", entity.enmCurrency);
            parameters.Add("@enmReceiptMethod", entity.enmReceiptMethod);
            parameters.Add("@InitialLoad", entity.InitialLoad);
            parameters.Add("@enmInitialLoadMethod_LoadMethod", entity.enmInitialLoadMethod_LoadMethod);
            parameters.Add("@CustomerID", entity.CustomerID);
            parameters.Add("@FirstName", entity.FirstName);
            parameters.Add("@LastName", entity.LastName);
            parameters.Add("@BirthDate", entity.BirthDate);
            parameters.Add("@IsraelIDNumber", entity.IsraelIDNumber);
            parameters.Add("@lkpPassportCountry_Country", entity.lkpPassportCountry_Country);
            parameters.Add("@PassportNumber", entity.PassportNumber);
            parameters.Add("@enmGender", entity.enmGender);
            parameters.Add("@ActualAddressNumber", entity.ActualAddressNumber);
            parameters.Add("@ActualAddressStreet", entity.ActualAddressStreet);
            parameters.Add("@ActualAddressCity", entity.ActualAddressCity);
            parameters.Add("@ActualZipCode", entity.ActualZipCode);
            parameters.Add("@CellphoneNumber", entity.CellphoneNumber);
            parameters.Add("@email", entity.email);
            parameters.Add("@spt_Comment", entity.CommentSeparate);
            parameters.Add("@WhenOpened", entity.WhenOpened);
            parameters.Add("@spt_enmCardRequestStatus", entity.enmCardRequestStatusSeparate);
            parameters.Add("@IsCustomerDefined", entity.IsCustomerDefined);
            parameters.Add("@IsKYCDefined", entity.IsKYCDefined);
            parameters.Add("@DeliveryFeeAdjustment", entity.DeliveryFeeAdjustment);
            parameters.Add("@DistributorSentToID", entity.DistributorSentToID);
            parameters.Add("@spt_InterviewedByUser", entity.InterviewedByUserSeparate);
            parameters.Add("@DeletedBy", entity.DeletedBy);
            parameters.Add("@DeletedOn", entity.DeletedOn);
            parameters.Add("@UpdatingLoginID", entity.UpdatingLoginID);
            parameters.Add("@enmLastStatusBeforeCancel_CardRequestStatus", entity.enmLastStatusBeforeCancel_CardRequestStatus);
            parameters.Add("@NameOnCard", entity.NameOnCard);
            parameters.Add("@enmPendingLoadMethod_LoadMethod", entity.enmPendingLoadMethod_LoadMethod);
            parameters.Add("@PendingLoadAmount", entity.PendingLoadAmount);
            parameters.Add("@PendingLoadReference", entity.PendingLoadReference);
            parameters.Add("@PendingLoadUserResponsible", entity.PendingLoadUserResponsible);
            parameters.Add("@CardActivationID", entity.CardActivationID);
            parameters.Add("@InitialLoadComplete", entity.InitialLoadComplete);
            parameters.Add("@CustomerWalletID", entity.CustomerWalletID);
            parameters.Add("@InitialLoadNumberOfPayments", entity.InitialLoadNumberOfPayments);
            parameters.Add("@IntendedClubID", entity.IntendedClubID);
            parameters.Add("@CommittedLoadAmount", entity.CommittedLoadAmount);
            parameters.Add("@CommittedPurchaseExchangeRateToILS", entity.CommittedPurchaseExchangeRateToILS);
            parameters.Add("@CommittedLoadFee", entity.CommittedLoadFee);
            parameters.Add("@CommittedDeliveryFee", entity.CommittedDeliveryFee);
            parameters.Add("@CommittedNewCardFee", entity.CommittedNewCardFee);
            parameters.Add("@enmCustomerType", entity.enmCustomerType);
            parameters.Add("@AddedBy", entity.AddedBy);

            await _connection.ExecuteAsync(
                "SP_AddNewCardRequest",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("NewCardRequest added successfully");
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error adding NewCardRequest");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task UpdateAsync(NewCardRequest entity, CancellationToken cancellationToken = default)
    {
        if (entity == null)
        {
            throw new ArgumentNullException(nameof(entity));
        }

        _logger.LogDebug("Updating NewCardRequest with ID: {Id}", entity.ID);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", entity.ID);
            parameters.Add("@TableName_NewCardRequest", entity.TableName_NewCardRequest);
            parameters.Add("@enmCurrency", entity.enmCurrency);
            parameters.Add("@enmReceiptMethod", entity.enmReceiptMethod);
            parameters.Add("@InitialLoad", entity.InitialLoad);
            parameters.Add("@enmInitialLoadMethod_LoadMethod", entity.enmInitialLoadMethod_LoadMethod);
            parameters.Add("@CustomerID", entity.CustomerID);
            parameters.Add("@FirstName", entity.FirstName);
            parameters.Add("@LastName", entity.LastName);
            parameters.Add("@BirthDate", entity.BirthDate);
            parameters.Add("@IsraelIDNumber", entity.IsraelIDNumber);
            parameters.Add("@lkpPassportCountry_Country", entity.lkpPassportCountry_Country);
            parameters.Add("@PassportNumber", entity.PassportNumber);
            parameters.Add("@enmGender", entity.enmGender);
            parameters.Add("@ActualAddressNumber", entity.ActualAddressNumber);
            parameters.Add("@ActualAddressStreet", entity.ActualAddressStreet);
            parameters.Add("@ActualAddressCity", entity.ActualAddressCity);
            parameters.Add("@ActualZipCode", entity.ActualZipCode);
            parameters.Add("@CellphoneNumber", entity.CellphoneNumber);
            parameters.Add("@email", entity.email);
            parameters.Add("@spt_Comment", entity.CommentSeparate);
            parameters.Add("@WhenOpened", entity.WhenOpened);
            parameters.Add("@spt_enmCardRequestStatus", entity.enmCardRequestStatusSeparate);
            parameters.Add("@IsCustomerDefined", entity.IsCustomerDefined);
            parameters.Add("@IsKYCDefined", entity.IsKYCDefined);
            parameters.Add("@DeliveryFeeAdjustment", entity.DeliveryFeeAdjustment);
            parameters.Add("@DistributorSentToID", entity.DistributorSentToID);
            parameters.Add("@spt_InterviewedByUser", entity.InterviewedByUserSeparate);
            parameters.Add("@DeletedBy", entity.DeletedBy);
            parameters.Add("@DeletedOn", entity.DeletedOn);
            parameters.Add("@UpdatingLoginID", entity.UpdatingLoginID);
            parameters.Add("@enmLastStatusBeforeCancel_CardRequestStatus", entity.enmLastStatusBeforeCancel_CardRequestStatus);
            parameters.Add("@NameOnCard", entity.NameOnCard);
            parameters.Add("@enmPendingLoadMethod_LoadMethod", entity.enmPendingLoadMethod_LoadMethod);
            parameters.Add("@PendingLoadAmount", entity.PendingLoadAmount);
            parameters.Add("@PendingLoadReference", entity.PendingLoadReference);
            parameters.Add("@PendingLoadUserResponsible", entity.PendingLoadUserResponsible);
            parameters.Add("@CardActivationID", entity.CardActivationID);
            parameters.Add("@InitialLoadComplete", entity.InitialLoadComplete);
            parameters.Add("@CustomerWalletID", entity.CustomerWalletID);
            parameters.Add("@InitialLoadNumberOfPayments", entity.InitialLoadNumberOfPayments);
            parameters.Add("@IntendedClubID", entity.IntendedClubID);
            parameters.Add("@CommittedLoadAmount", entity.CommittedLoadAmount);
            parameters.Add("@CommittedPurchaseExchangeRateToILS", entity.CommittedPurchaseExchangeRateToILS);
            parameters.Add("@CommittedLoadFee", entity.CommittedLoadFee);
            parameters.Add("@CommittedDeliveryFee", entity.CommittedDeliveryFee);
            parameters.Add("@CommittedNewCardFee", entity.CommittedNewCardFee);
            parameters.Add("@enmCustomerType", entity.enmCustomerType);
            parameters.Add("@ChangedBy", entity.ChangedBy);

            await _connection.ExecuteAsync(
                "SP_UpdateNewCardRequest",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("NewCardRequest updated successfully. ID: {Id}", entity.ID);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error updating NewCardRequest with ID: {Id}", entity.ID);
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task DeleteAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Deleting NewCardRequest with ID: {Id}", id);

        try
        {
            await _connection.ExecuteAsync(
                "SP_DeleteNewCardRequest",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("NewCardRequest deleted successfully. ID: {Id}", id);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error deleting NewCardRequest with ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<NewCardRequest?> GetByNewCardRequestAPIIDAsync(long newCardRequestAPIID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by blg_NewCardRequestAPIID");

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<NewCardRequest>(
                "SP_GetNewCardRequestByNewCardRequestAPIID",
                new { NewCardRequestAPIID = newCardRequestAPIID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("NewCardRequest found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by blg_NewCardRequestAPIID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<NewCardRequest?> GetByCardActivationIDAsync(long cardActivationID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by CardActivationID");

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<NewCardRequest>(
                "SP_GetNewCardRequestByCardActivationID",
                new { CardActivationID = cardActivationID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("NewCardRequest found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by CardActivationID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByIntendedClubIDAsync(long intendedClubID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by IntendedClubID");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByIntendedClubID",
                new { IntendedClubID = intendedClubID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by IntendedClubID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByNewCardRequestAPILoggedAlertIDAsync(long newCardRequestAPILoggedAlertID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by clc_NewCardRequestAPILoggedAlertID");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByNewCardRequestAPILoggedAlertID",
                new { NewCardRequestAPILoggedAlertID = newCardRequestAPILoggedAlertID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by clc_NewCardRequestAPILoggedAlertID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByCustomerIDAsync(long customerID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by CustomerID");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByCustomerID",
                new { CustomerID = customerID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by CustomerID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByDistributorSentToIDAsync(long distributorSentToID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by DistributorSentToID");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByDistributorSentToID",
                new { DistributorSentToID = distributorSentToID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by DistributorSentToID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByFirstNameAsync(string firstName, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by FirstName");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByFirstName",
                new { FirstName = firstName },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by FirstName");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByIsraelIDNumberAndlkpPassportCountry_CountryAndPassportNumberAsync(string israelIDNumber, string lkpPassportCountry_Country, string passportNumber, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by IsraelIDNumber, lkpPassportCountry_Country, PassportNumber");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByIsraelIDNumberAndlkpPassportCountry_CountryAndPassportNumber",
                new { IsraelIDNumber = israelIDNumber, lkpPassportCountry_Country = lkpPassportCountry_Country, PassportNumber = passportNumber },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by IsraelIDNumber, lkpPassportCountry_Country, PassportNumber");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByLastNameAsync(string lastName, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by LastName");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByLastName",
                new { LastName = lastName },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by LastName");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByenmLastStatusBeforeCancel_CardRequestStatusAsync(string enmLastStatusBeforeCancel_CardRequestStatus, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by enmLastStatusBeforeCancel_CardRequestStatus");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByenmLastStatusBeforeCancel_CardRequestStatus",
                new { enmLastStatusBeforeCancel_CardRequestStatus = enmLastStatusBeforeCancel_CardRequestStatus },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by enmLastStatusBeforeCancel_CardRequestStatus");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByenmReceiptMethodAndenmCardRequestStatusAsync(string enmReceiptMethod, string enmCardRequestStatus, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by enmReceiptMethod, spt_enmCardRequestStatus");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByenmReceiptMethodAndenmCardRequestStatus",
                new { enmReceiptMethod = enmReceiptMethod, enmCardRequestStatus = enmCardRequestStatus },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by enmReceiptMethod, spt_enmCardRequestStatus");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByenmCardRequestStatusAsync(string enmCardRequestStatus, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by spt_enmCardRequestStatus");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByenmCardRequestStatus",
                new { enmCardRequestStatus = enmCardRequestStatus },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by spt_enmCardRequestStatus");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<IEnumerable<NewCardRequest>> GetByWhenStatusChangedAsync(DateTimeOffset whenStatusChanged, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting NewCardRequest by clc_WhenStatusChanged");

        try
        {
            var result = await _connection.QueryAsync<NewCardRequest>(
                "SP_GetNewCardRequestByWhenStatusChanged",
                new { WhenStatusChanged = whenStatusChanged },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} NewCardRequest entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting NewCardRequest by clc_WhenStatusChanged");
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<bool> ExistsAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Checking if NewCardRequest exists with ID: {Id}", id);

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<NewCardRequest>(
                "SP_GetNewCardRequestByID",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            bool exists = result != null;
            _logger.LogDebug("NewCardRequest exists: {Exists}", exists);
            return exists;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error checking if NewCardRequest exists. ID: {Id}", id);
            throw;
        }
    }
}
