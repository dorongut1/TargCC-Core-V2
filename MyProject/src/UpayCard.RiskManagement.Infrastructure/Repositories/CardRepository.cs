// <auto-generated>
//     This code was generated by TargCC.Core.Generators v2.0
//     Generated from table: dbo.Card
//     Generation date: 2025-12-15 20:38:12
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

namespace UpayCard.RiskManagement.Infrastructure.Repositories;

using System.Data;
using System.Threading;
using System.Threading.Tasks;
using Dapper;
using Microsoft.Extensions.Logging;
using UpayCard.RiskManagement.Domain.Entities;
using UpayCard.RiskManagement.Domain.Interfaces;

/// <summary>
/// Repository implementation for Card entity data access operations.
/// </summary>
/// <remarks>
/// <para>
/// This repository provides data access for the Card entity using Dapper
/// for stored procedure calls. All operations are async and support cancellation.
/// </para>
/// </remarks>
public class CardRepository : ICardRepository
{
    private readonly IDbConnection _connection;
    private readonly ILogger<CardRepository> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="CardRepository"/> class.
    /// </summary>
    /// <param name="connection">Database connection for Dapper operations.</param>
    /// <param name="logger">Logger for tracking repository operations.</param>
    public CardRepository(IDbConnection connection, ILogger<CardRepository> logger)
    {
        _connection = connection ?? throw new ArgumentNullException(nameof(connection));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<Card?> GetByIdAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by ID: {Id}", id);

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<Card>(
                "SP_GetCardByID",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Card found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetAllAsync(int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting all Card entities. Skip: {Skip}, Take: {Take}", skip, take);

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetAllCards",
                new { Skip = skip, Take = take },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting all Card entities");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetFilteredAsync(string? cid = null, string? cardLast4Numbers = null, long? customerID = null, string? enmIsOnTerrorList = null, long? cardOrderByDistributorID = null, string? enmCurrency = null, long? cardClubID = null, long? cardOrderFromIssuerID = null, long? owningDistributorID = null, long? previousDistributorID = null, string? enmStatusAtCardIssuer = null, string? enmStatusAtICP = null, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting filtered Card entities");

        try
        {
            var parameters = new {
                Cid = cid,
                CardLast4Numbers = cardLast4Numbers,
                CustomerID = customerID,
                spt_enmIsOnTerrorList = enmIsOnTerrorList,
                CardOrderByDistributorID = cardOrderByDistributorID,
                enmCurrency = enmCurrency,
                CardClubID = cardClubID,
                CardOrderFromIssuerID = cardOrderFromIssuerID,
                OwningDistributorID = owningDistributorID,
                PreviousDistributorID = previousDistributorID,
                enmStatusAtCardIssuer = enmStatusAtCardIssuer,
                enmStatusAtICP = enmStatusAtICP,
                Skip = skip,
                Take = take
            };

            var result = await _connection.QueryAsync<Card>(
                "SP_GetFilteredCards",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} filtered Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting filtered Card entities");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task AddAsync(Card entity, CancellationToken cancellationToken = default)
    {
        if (entity == null)
        {
            throw new ArgumentNullException(nameof(entity));
        }

        _logger.LogDebug("Adding new Card");

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@TableName_Card", entity.TableName_Card);
            parameters.Add("@CardClubID", entity.CardClubID);
            parameters.Add("@Cid", entity.Cid);
            parameters.Add("@CardLast4Numbers", entity.CardLast4Numbers);
            parameters.Add("@Expiry", entity.Expiry);
            parameters.Add("@CustomerID", entity.CustomerID);
            parameters.Add("@enmCurrency", entity.enmCurrency);
            parameters.Add("@OwningDistributorID", entity.OwningDistributorID);
            parameters.Add("@CardOrderFromIssuerID", entity.CardOrderFromIssuerID);
            parameters.Add("@CardOrderByDistributorID", entity.CardOrderByDistributorID);
            parameters.Add("@ActivationDate", entity.ActivationDate);
            parameters.Add("@IsLost", entity.IsLost);
            parameters.Add("@ReportedLostWhen", entity.ReportedLostWhen);
            parameters.Add("@LastBalance", entity.LastBalance);
            parameters.Add("@LastBalanceTime", entity.LastBalanceTime);
            parameters.Add("@enmStatusAtCardIssuer", entity.enmStatusAtCardIssuer);
            parameters.Add("@enmStatusAtICP", entity.enmStatusAtICPSeparate);
            parameters.Add("@WhenStatusAtICPChanged", entity.WhenStatusAtICPChanged);
            parameters.Add("@StatusAtICPChangedBy", entity.StatusAtICPChangedBy);
            parameters.Add("@spt_Comment", entity.CommentSeparate);
            parameters.Add("@DeletedBy", entity.DeletedBy);
            parameters.Add("@DeletedOn", entity.DeletedOn);
            parameters.Add("@UpdatingLoginID", entity.UpdatingLoginID);
            parameters.Add("@PreviousDistributorID", entity.PreviousDistributorID);
            parameters.Add("@EmbossedText", entity.EmbossedText);
            parameters.Add("@logCellPhone", entity.logCellPhone);
            parameters.Add("@spt_IsCashWithdrawalAllowed", entity.IsCashWithdrawalAllowedSeparate);
            parameters.Add("@spt_LastMonthlyFeeDatePaid", entity.LastMonthlyFeeDatePaidSeparate);
            parameters.Add("@CardHolderName", entity.CardHolderName);
            parameters.Add("@CardHolderPhoneNumberOrEmail", entity.CardHolderPhoneNumberOrEmail);
            parameters.Add("@CardHolderIdentifier", entity.CardHolderIdentifier);
            parameters.Add("@spt_enmIsOnTerrorList", entity.enmIsOnTerrorListSeparate);
            parameters.Add("@spt_TerrorListUpdatedOn", entity.TerrorListUpdatedOnSeparate);
            parameters.Add("@AddedBy", entity.AddedBy);

            await _connection.ExecuteAsync(
                "SP_AddCard",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Card added successfully");
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error adding Card");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task UpdateAsync(Card entity, CancellationToken cancellationToken = default)
    {
        if (entity == null)
        {
            throw new ArgumentNullException(nameof(entity));
        }

        _logger.LogDebug("Updating Card with ID: {Id}", entity.ID);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", entity.ID);
            parameters.Add("@TableName_Card", entity.TableName_Card);
            parameters.Add("@CardClubID", entity.CardClubID);
            parameters.Add("@Cid", entity.Cid);
            parameters.Add("@CardLast4Numbers", entity.CardLast4Numbers);
            parameters.Add("@Expiry", entity.Expiry);
            parameters.Add("@CustomerID", entity.CustomerID);
            parameters.Add("@enmCurrency", entity.enmCurrency);
            parameters.Add("@OwningDistributorID", entity.OwningDistributorID);
            parameters.Add("@CardOrderFromIssuerID", entity.CardOrderFromIssuerID);
            parameters.Add("@CardOrderByDistributorID", entity.CardOrderByDistributorID);
            parameters.Add("@ActivationDate", entity.ActivationDate);
            parameters.Add("@IsLost", entity.IsLost);
            parameters.Add("@ReportedLostWhen", entity.ReportedLostWhen);
            parameters.Add("@LastBalance", entity.LastBalance);
            parameters.Add("@LastBalanceTime", entity.LastBalanceTime);
            parameters.Add("@enmStatusAtCardIssuer", entity.enmStatusAtCardIssuer);
            parameters.Add("@enmStatusAtICP", entity.enmStatusAtICPSeparate);
            parameters.Add("@WhenStatusAtICPChanged", entity.WhenStatusAtICPChanged);
            parameters.Add("@StatusAtICPChangedBy", entity.StatusAtICPChangedBy);
            parameters.Add("@spt_Comment", entity.CommentSeparate);
            parameters.Add("@DeletedBy", entity.DeletedBy);
            parameters.Add("@DeletedOn", entity.DeletedOn);
            parameters.Add("@UpdatingLoginID", entity.UpdatingLoginID);
            parameters.Add("@PreviousDistributorID", entity.PreviousDistributorID);
            parameters.Add("@EmbossedText", entity.EmbossedText);
            parameters.Add("@logCellPhone", entity.logCellPhone);
            parameters.Add("@spt_IsCashWithdrawalAllowed", entity.IsCashWithdrawalAllowedSeparate);
            parameters.Add("@spt_LastMonthlyFeeDatePaid", entity.LastMonthlyFeeDatePaidSeparate);
            parameters.Add("@CardHolderName", entity.CardHolderName);
            parameters.Add("@CardHolderPhoneNumberOrEmail", entity.CardHolderPhoneNumberOrEmail);
            parameters.Add("@CardHolderIdentifier", entity.CardHolderIdentifier);
            parameters.Add("@spt_enmIsOnTerrorList", entity.enmIsOnTerrorListSeparate);
            parameters.Add("@spt_TerrorListUpdatedOn", entity.TerrorListUpdatedOnSeparate);
            parameters.Add("@ChangedBy", entity.ChangedBy);

            await _connection.ExecuteAsync(
                "SP_UpdateCard",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Card updated successfully. ID: {Id}", entity.ID);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error updating Card with ID: {Id}", entity.ID);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task DeleteAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Deleting Card with ID: {Id}", id);

        try
        {
            await _connection.ExecuteAsync(
                "SP_DeleteCard",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Card deleted successfully. ID: {Id}", id);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error deleting Card with ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<Card?> GetByCidAndCardLast4NumbersAsync(string cid, string cardLast4Numbers, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by Cid, CardLast4Numbers");

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<Card>(
                "SP_GetCardByCidAndCardLast4Numbers",
                new { Cid = cid, CardLast4Numbers = cardLast4Numbers },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Card found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by Cid, CardLast4Numbers");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<Card?> GetByCidAndCustomerIDAsync(string cid, long customerID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by Cid, CustomerID");

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<Card>(
                "SP_GetCardByCidAndCustomerID",
                new { Cid = cid, CustomerID = customerID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Card found: {Found}", result != null);
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by Cid, CustomerID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByenmIsOnTerrorListAsync(string enmIsOnTerrorList, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by spt_enmIsOnTerrorList");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByenmIsOnTerrorList",
                new { enmIsOnTerrorList = enmIsOnTerrorList },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by spt_enmIsOnTerrorList");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByCardOrderByDistributorIDAsync(long cardOrderByDistributorID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by CardOrderByDistributorID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByCardOrderByDistributorID",
                new { CardOrderByDistributorID = cardOrderByDistributorID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by CardOrderByDistributorID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByCardOrderByDistributorIDAndenmCurrencyAndCardClubIDAsync(long cardOrderByDistributorID, string enmCurrency, long cardClubID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by CardOrderByDistributorID, enmCurrency, CardClubID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByCardOrderByDistributorIDAndenmCurrencyAndCardClubID",
                new { CardOrderByDistributorID = cardOrderByDistributorID, enmCurrency = enmCurrency, CardClubID = cardClubID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by CardOrderByDistributorID, enmCurrency, CardClubID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByCardOrderFromIssuerIDAsync(long cardOrderFromIssuerID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by CardOrderFromIssuerID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByCardOrderFromIssuerID",
                new { CardOrderFromIssuerID = cardOrderFromIssuerID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by CardOrderFromIssuerID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByCidAsync(string cid, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by Cid");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByCid",
                new { Cid = cid },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by Cid");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByCardClubIDAsync(long cardClubID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by CardClubID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByCardClubID",
                new { CardClubID = cardClubID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by CardClubID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByCustomerIDAsync(long customerID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by CustomerID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByCustomerID",
                new { CustomerID = customerID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by CustomerID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByOwningDistributorIDAsync(long owningDistributorID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by OwningDistributorID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByOwningDistributorID",
                new { OwningDistributorID = owningDistributorID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by OwningDistributorID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByOwningDistributorIDAndenmCurrencyAndCustomerIDAsync(long owningDistributorID, string enmCurrency, long customerID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by OwningDistributorID, enmCurrency, CustomerID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByOwningDistributorIDAndenmCurrencyAndCustomerID",
                new { OwningDistributorID = owningDistributorID, enmCurrency = enmCurrency, CustomerID = customerID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by OwningDistributorID, enmCurrency, CustomerID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByPreviousDistributorIDAsync(long previousDistributorID, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by PreviousDistributorID");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByPreviousDistributorID",
                new { PreviousDistributorID = previousDistributorID },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by PreviousDistributorID");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByenmStatusAtCardIssuerAsync(string enmStatusAtCardIssuer, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by enmStatusAtCardIssuer");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByenmStatusAtCardIssuer",
                new { enmStatusAtCardIssuer = enmStatusAtCardIssuer },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by enmStatusAtCardIssuer");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<Card>> GetByenmStatusAtICPAsync(string enmStatusAtICP, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Getting Card by enmStatusAtICP");

        try
        {
            var result = await _connection.QueryAsync<Card>(
                "SP_GetCardByenmStatusAtICP",
                new { enmStatusAtICP = enmStatusAtICP },
                commandType: CommandType.StoredProcedure);

            _logger.LogDebug("Retrieved {Count} Card entities", result.Count());
            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error getting Card by enmStatusAtICP");
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task UpdateAggregatesAsync(long id, int loadsToday, int loadsThisMonth, decimal amountLoadedToday, decimal amountLoadedThisMonth, decimal amountLoadedTotal, int loadsTotal, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Updating Card aggregates for ID: {Id}", id);

        try
        {
            await _connection.ExecuteAsync(
                "SP_UpdateCardAggregates",
                new { ID = id, LoadsToday = loadsToday, LoadsThisMonth = loadsThisMonth, AmountLoadedToday = amountLoadedToday, AmountLoadedThisMonth = amountLoadedThisMonth, AmountLoadedTotal = amountLoadedTotal, LoadsTotal = loadsTotal },
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Card aggregates updated successfully. ID: {Id}", id);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error updating Card aggregates. ID: {Id}", id);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<BackofficeTransaction>> GetBackofficeTransactionsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching BACKOFFICETRANSACTIONS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<BackofficeTransaction>(
                "SP_GetCardBackofficeTransactions",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} BACKOFFICETRANSACTIONS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching BACKOFFICETRANSACTIONS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<CardActivation>> GetCardActivationsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching CARDACTIVATIONS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<CardActivation>(
                "SP_GetCardCardActivations",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} CARDACTIVATIONS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching CARDACTIVATIONS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<CustomerCardTransaction>> GetCustomerCardTransactionsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching CUSTOMERCARDTRANSACTIONS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<CustomerCardTransaction>(
                "SP_GetCardCustomerCardTransactions",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} CUSTOMERCARDTRANSACTIONS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching CUSTOMERCARDTRANSACTIONS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<ImportTransactionLoadRow>> GetImportTransactionLoadRowsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching IMPORTTRANSACTIONLOADROWS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<ImportTransactionLoadRow>(
                "SP_GetCardImportTransactionLoadRows",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} IMPORTTRANSACTIONLOADROWS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching IMPORTTRANSACTIONLOADROWS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<OnlineApproval>> GetOnlineApprovalsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching ONLINEAPPROVALS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<OnlineApproval>(
                "SP_GetCardOnlineApprovals",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} ONLINEAPPROVALS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching ONLINEAPPROVALS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<RequestedTransaction>> GetRequestedTransactionsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching REQUESTEDTRANSACTIONS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<RequestedTransaction>(
                "SP_GetCardRequestedTransactions",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} REQUESTEDTRANSACTIONS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching REQUESTEDTRANSACTIONS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async System.Threading.Tasks.Task<IEnumerable<TransactionLoad>> GetTransactionLoadsAsync(long cardId, int? skip = null, int? take = null, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Fetching TRANSACTIONLOADS for Card ID: {CardId}", cardId);

        try
        {
            var parameters = new DynamicParameters();
            parameters.Add("@ID", cardId);
            parameters.Add("@Skip", skip);
            parameters.Add("@Take", take);

            var result = await _connection.QueryAsync<TransactionLoad>(
                "SP_GetCardTransactionLoads",
                parameters,
                commandType: CommandType.StoredProcedure);

            _logger.LogInformation("Retrieved {Count} TRANSACTIONLOADS for Card ID: {CardId}", result.Count(), cardId);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error fetching TRANSACTIONLOADS for Card ID: {CardId}", cardId);
            throw;
        }
    }

    /// <inheritdoc/>
    public async Task<bool> ExistsAsync(long id, CancellationToken cancellationToken = default)
    {
        _logger.LogDebug("Checking if Card exists with ID: {Id}", id);

        try
        {
            var result = await _connection.QueryFirstOrDefaultAsync<Card>(
                "SP_GetCardByID",
                new { ID = id },
                commandType: CommandType.StoredProcedure);

            bool exists = result != null;
            _logger.LogDebug("Card exists: {Exists}", exists);
            return exists;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Error checking if Card exists. ID: {Id}", id);
            throw;
        }
    }
}
