# Entity Generator - ××¤×™×•×Ÿ ××¤×•×¨×˜ ğŸ“‹

**×ª××¨×™×š:** 17/11/2025  
**×’×¨×¡×”:** 1.0  
**×¡×˜×˜×•×¡:** Draft for Review

---

## ğŸ¯ ××˜×¨×”

×™×¦×™×¨×ª C# Entity classes ×-Table schema, ×¢× ×˜×™×¤×•×œ ××œ× ×‘-12 ×¡×•×’×™ ×¤×¨×™×¤×™×§×¡×™× ×©×œ TargCC, relationships, validation, ×•-metadata.

---

## ğŸ“¦ ××‘× ×” ××—×œ×§×•×ª

```
TargCC.Core.Generators/Entities/
â”œâ”€â”€ IEntityGenerator.cs          - ×××©×§ ×¨××©×™
â”œâ”€â”€ EntityGenerator.cs            - ×× ×•×¢ ×¨××©×™
â”œâ”€â”€ PropertyGenerator.cs          - ×™×¦×™×¨×ª Properties
â”œâ”€â”€ TypeMapper.cs                 - SQL â†’ C# types
â”œâ”€â”€ PrefixHandler.cs              - ×˜×™×¤×•×œ ×‘×¤×¨×™×¤×™×§×¡×™×
â”œâ”€â”€ RelationshipGenerator.cs      - Navigation properties
â”œâ”€â”€ MethodGenerator.cs            - Constructor, ToString, Clone
â””â”€â”€ AttributeGenerator.cs         - Validation, Serialization attributes
```

---

## ğŸ”§ IEntityGenerator Interface

```csharp
public interface IEntityGenerator
{
    /// <summary>
    /// Generates a C# entity class from a table schema.
    /// </summary>
    /// <param name="table">The table to generate entity for.</param>
    /// <returns>Generated C# class code.</returns>
    Task<string> GenerateAsync(Table table);
    
    /// <summary>
    /// Generates entities for all tables in a database schema.
    /// </summary>
    /// <param name="schema">The database schema.</param>
    /// <returns>Dictionary of ClassName â†’ Code.</returns>
    Task<Dictionary<string, string>> GenerateAllAsync(DatabaseSchema schema);
}
```

---

## ğŸ“ ××‘× ×” Entity Class

### Template ×‘×¡×™×¡×™:

```csharp
// <auto-generated>
//     This code was generated by TargCC.Core.Generators.
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>

using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace YourNamespace.Entities
{
    /// <summary>
    /// Entity class for {TableName} table.
    /// Generated: {DateTime}
    /// </summary>
    [Table("{TableName}")]
    public partial class {ClassName}
    {
        #region Properties
        
        // Primary Key
        // Regular columns
        // Prefixed columns (eno_, ent_, etc.)
        // Audit columns
        
        #endregion
        
        #region Relationships
        
        // Navigation properties
        // Foreign key references
        
        #endregion
        
        #region Constructors
        
        public {ClassName}()
        {
            // Initialize collections
        }
        
        #endregion
        
        #region Methods
        
        public override string ToString() { }
        public {ClassName} Clone() { }
        public override bool Equals(object obj) { }
        public override int GetHashCode() { }
        
        #endregion
    }
}
```

---

## ğŸ·ï¸ TypeMapper - SQL â†’ C# Type Mapping

### ××™×¤×•×™ ××œ×:

| SQL Type | C# Type | Nullable? | Default Value |
|----------|---------|-----------|---------------|
| **Integer Types** |
| `int`, `INT` | `int` | `int?` | `0` |
| `bigint`, `BIGINT` | `long` | `long?` | `0L` |
| `smallint`, `SMALLINT` | `short` | `short?` | `0` |
| `tinyint`, `TINYINT` | `byte` | `byte?` | `0` |
| **Decimal Types** |
| `decimal`, `numeric` | `decimal` | `decimal?` | `0m` |
| `money`, `smallmoney` | `decimal` | `decimal?` | `0m` |
| `float` | `double` | `double?` | `0.0` |
| `real` | `float` | `float?` | `0f` |
| **String Types** |
| `varchar(n)`, `char(n)` | `string` | Always nullable | `null` |
| `nvarchar(n)`, `nchar(n)` | `string` | Always nullable | `null` |
| `varchar(MAX)`, `nvarchar(MAX)` | `string` | Always nullable | `null` |
| `text`, `ntext` | `string` | Always nullable | `null` |
| **Date/Time Types** |
| `datetime`, `datetime2` | `DateTime` | `DateTime?` | `DateTime.Now` |
| `date` | `DateTime` | `DateTime?` | `DateTime.Today` |
| `time` | `TimeSpan` | `TimeSpan?` | `TimeSpan.Zero` |
| `datetimeoffset` | `DateTimeOffset` | `DateTimeOffset?` | `DateTimeOffset.Now` |
| **Binary Types** |
| `varbinary(n)`, `binary(n)` | `byte[]` | Always nullable | `null` |
| `varbinary(MAX)` | `byte[]` | Always nullable | `null` |
| `image` | `byte[]` | Always nullable | `null` |
| **Other Types** |
| `bit` | `bool` | `bool?` | `false` |
| `uniqueidentifier` | `Guid` | `Guid?` | `Guid.Empty` |
| `xml` | `string` | Always nullable | `null` |

### ×“×•×’××” ×œ×§×•×“:

```csharp
public class TypeMapper
{
    public static string MapSqlTypeToCSharp(Column column)
    {
        var baseType = column.SqlDataType.ToLowerInvariant();
        
        var csharpType = baseType switch
        {
            "int" => "int",
            "bigint" => "long",
            "smallint" => "short",
            "tinyint" => "byte",
            "decimal" or "numeric" or "money" or "smallmoney" => "decimal",
            "float" => "double",
            "real" => "float",
            "varchar" or "nvarchar" or "char" or "nchar" or "text" or "ntext" => "string",
            "datetime" or "datetime2" or "date" => "DateTime",
            "time" => "TimeSpan",
            "datetimeoffset" => "DateTimeOffset",
            "bit" => "bool",
            "uniqueidentifier" => "Guid",
            "varbinary" or "binary" or "image" => "byte[]",
            "xml" => "string",
            _ => "object" // fallback
        };
        
        // Add nullable modifier if needed
        if (column.IsNullable && IsValueType(csharpType))
        {
            return $"{csharpType}?";
        }
        
        return csharpType;
    }
    
    private static bool IsValueType(string type)
    {
        return type is not ("string" or "byte[]" or "object");
    }
}
```

---

## ğŸ¨ ×˜×™×¤×•×œ ×‘×¤×¨×™×¤×™×§×¡×™× - 12 ×¡×•×’×™×

### 1. **eno_** (One-Way Encryption - Hashed)

**××˜×¨×”:** ×©×“×•×ª ×©××•×¦×¤× ×™× ×—×“-×›×™×•×•× ×™×ª (passwords, PIN)

**×“×•×’××” SQL:**
```sql
eno_Password VARCHAR(64) NOT NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Hashed password (one-way encryption).
/// Note: This field is hashed by the application before saving.
/// </summary>
[Column("eno_Password")]
[Required]
[MaxLength(64)]
[JsonIgnore] // Don't serialize passwords
public string PasswordHashed { get; private set; }

// Helper method for setting password
public void SetPassword(string plainTextPassword)
{
    if (string.IsNullOrEmpty(plainTextPassword))
        throw new ArgumentNullException(nameof(plainTextPassword));
    
    // Hash will be done by business logic layer
    this.PasswordHashed = $"[PleaseHash]{plainTextPassword}";
}
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `Hashed`
- âœ… `private set` - ×œ× × ×™×ª×Ÿ ×œ×¢×“×›×•×Ÿ ×™×©×™×¨
- âœ… `[JsonIgnore]` - ×œ× × ×©×œ×— ×‘-API
- âœ… Helper method: `SetPassword()`

---

### 2. **ent_** (Two-Way Encryption)

**××˜×¨×”:** ×©×“×•×ª ×©××•×¦×¤× ×™× ×“×•-×›×™×•×•× ×™×ª (credit cards, SSN)

**×“×•×’××” SQL:**
```sql
ent_CreditCard VARCHAR(MAX) NULL
```

**×“×•×’××” C#:**
```csharp
private string _creditCardEncrypted;

/// <summary>
/// Credit card number (two-way encrypted).
/// Automatically encrypted/decrypted by the application.
/// </summary>
[Column("ent_CreditCard")]
[MaxLength(int.MaxValue)]
[JsonIgnore] // Don't serialize sensitive data
public string CreditCard
{
    get => DecryptValue(_creditCardEncrypted);
    set => _creditCardEncrypted = EncryptValue(value);
}

// These methods are implemented by business logic layer
private string EncryptValue(string plainText) => 
    string.IsNullOrEmpty(plainText) ? null : $"[PleaseEncrypt]{plainText}";
    
private string DecryptValue(string encrypted) => 
    string.IsNullOrEmpty(encrypted) ? null : $"[PleaseDecrypt]{encrypted}";
```

**×××¤×™×™× ×™×:**
- âœ… Private backing field: `_creditCardEncrypted`
- âœ… Public property ×¢× get/set
- âœ… Encrypt/Decrypt helpers (placeholder)
- âœ… `[JsonIgnore]` - ×œ× × ×©×œ×— ×‘-API

---

### 3. **lkp_** (Lookup - Foreign Key Text)

**××˜×¨×”:** ×©×“×•×ª ×©××›×™×œ×™× ×¢×¨×›×™× ××˜×‘×œ×ª lookup

**×“×•×’××” SQL:**
```sql
lkp_Status NVARCHAR(50) NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Status lookup value.
/// Links to StatusLookup table.
/// </summary>
[Column("lkp_Status")]
[MaxLength(50)]
public string Status { get; set; }

/// <summary>
/// Display text for Status (if available from lookup table).
/// This is loaded separately by business logic.
/// </summary>
[NotMapped]
public string StatusText { get; set; }
```

**×××¤×™×™× ×™×:**
- âœ… Property name: ×©× ×‘×œ×™ prefix
- âœ… × ×•×¡×£ property: `{Name}Text`
- âœ… `[NotMapped]` ×¢×œ ×”-Text property

---

### 4. **enm_** (Enumeration)

**××˜×¨×”:** ×©×“×•×ª ×©××™×™×¦×’×™× enum ×‘-C#

**×“×•×’××” SQL:**
```sql
enm_OrderStatus INT NOT NULL DEFAULT 0
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Order status enumeration.
/// </summary>
[Column("enm_OrderStatus")]
[Required]
public OrderStatusEnum OrderStatus { get; set; } = OrderStatusEnum.Pending;

/// <summary>
/// Order status enumeration values.
/// </summary>
public enum OrderStatusEnum
{
    Pending = 0,
    Processing = 1,
    Shipped = 2,
    Delivered = 3,
    Cancelled = 4
}
```

**×××¤×™×™× ×™×:**
- âœ… Property type: `{Name}Enum`
- âœ… Enum × ×•×¦×¨ ×‘× ×¤×¨×“ (××• ××™×•×‘×)
- âœ… Default value ×-DB

---

### 5. **loc_** (Localization)

**××˜×¨×”:** ×©×“×•×ª ×©×™×© ×œ×”× ×ª×¨×’×•××™×

**×“×•×’××” SQL:**
```sql
loc_Description NVARCHAR(500) NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Localized description.
/// Supports multiple languages through localization system.
/// </summary>
[Column("loc_Description")]
[MaxLength(500)]
public string Description { get; set; }

/// <summary>
/// Gets the localized description for current culture.
/// </summary>
[NotMapped]
public string DescriptionLocalized => 
    LocalizationHelper.GetLocalizedValue(this.Description);
```

**×××¤×™×™× ×™×:**
- âœ… Property name: ×©× ×‘×œ×™ prefix
- âœ… × ×•×¡×£ property: `{Name}Localized`
- âœ… `[NotMapped]` ×¢×œ ×”-Localized

---

### 6. **clc_** (Calculated)

**××˜×¨×”:** ×©×“×•×ª ××—×•×©×‘×™× (computed columns)

**×“×•×’××” SQL:**
```sql
clc_TotalAmount DECIMAL(18,2) NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Calculated total amount (read-only).
/// This value is calculated by the database.
/// </summary>
[Column("clc_TotalAmount")]
[DatabaseGenerated(DatabaseGeneratedOption.Computed)]
public decimal? TotalAmountCalculated { get; private set; }
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `Calculated`
- âœ… `private set` - read-only
- âœ… `[DatabaseGenerated(Computed)]`

---

### 7. **blg_** (Business Logic)

**××˜×¨×”:** ×©×“×•×ª ×©××—×•×©×‘×™× ×¢"×™ business logic

**×“×•×’××” SQL:**
```sql
blg_CreditScore INT NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Credit score (calculated by business logic).
/// This value is set by the application, not the database.
/// Read-only on client side.
/// </summary>
[Column("blg_CreditScore")]
public int? CreditScore { get; internal set; }
```

**×××¤×™×™× ×™×:**
- âœ… Property name: ×©× ×‘×œ×™ prefix
- âœ… `internal set` - ×¨×§ business logic ×™×›×•×œ ×œ×©× ×•×ª
- âœ… ×œ× `[DatabaseGenerated]`

---

### 8. **agg_** (Aggregate)

**××˜×¨×”:** ×©×“×•×ª ×©××›×™×œ×™× aggregations (COUNT, SUM)

**×“×•×’××” SQL:**
```sql
agg_OrderCount INT NULL DEFAULT 0
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Aggregated order count.
/// Updated by separate aggregate procedures.
/// Read-only on client side.
/// </summary>
[Column("agg_OrderCount")]
public int OrderCountAggregate { get; internal set; }
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `Aggregate`
- âœ… `internal set` - ×¨×§ aggregation logic
- âœ… Default value: `0` for numbers

---

### 9. **spt_** (Separate Update)

**××˜×¨×”:** ×©×“×•×ª ×©××ª×¢×“×›× ×™× ×‘× ×¤×¨×“ (×’×“×•×œ×™×, ×œ× ××©×ª× ×™× ×”×¨×‘×”)

**×“×•×’××” SQL:**
```sql
spt_Comments NVARCHAR(MAX) NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Comments (updated separately).
/// Use UpdateComments() method to update this field.
/// </summary>
[Column("spt_Comments")]
[MaxLength(int.MaxValue)]
public string CommentsSeparate { get; set; }

/// <summary>
/// Updates the comments field separately.
/// Calls SP_Update{Table}Comments stored procedure.
/// </summary>
public void UpdateComments(string comments)
{
    this.CommentsSeparate = comments;
    // Business logic will call separate SP
}
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `Separate`
- âœ… Helper method: `Update{Name}()`
- âœ… Comment ××¡×‘×™×¨ ×©×–×” separate update

---

### 10. **upl_** (Upload - File Path)

**××˜×¨×”:** ×©×“×•×ª ×©××›×™×œ×™× paths ×œ×§×‘×¦×™×

**×“×•×’××” SQL:**
```sql
upl_ProfileImage NVARCHAR(500) NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Profile image file path or URL.
/// </summary>
[Column("upl_ProfileImage")]
[MaxLength(500)]
[Url] // Validation attribute
public string ProfileImageUpload { get; set; }

/// <summary>
/// Gets the full URL for the uploaded file.
/// </summary>
[NotMapped]
public string ProfileImageUrl => 
    string.IsNullOrEmpty(ProfileImageUpload) 
        ? null 
        : $"{ConfigHelper.GetFileBaseUrl()}/{ProfileImageUpload}";
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `Upload`
- âœ… `[Url]` validation attribute
- âœ… × ×•×¡×£ property: `{Name}Url`

---

### 11. **FUI_** (Fake Unique Index)

**××˜×¨×”:** columns ×©× ×¨××™× unique ××‘×œ ×œ× ×‘×××ª

**×“×•×’××” SQL:**
```sql
FUI_TempID INT NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// Temporary ID (fake unique index).
/// This field is not truly unique and should be used with caution.
/// </summary>
[Column("FUI_TempID")]
public int? TempIdFakeUnique { get; set; }
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `FakeUnique`
- âœ… Comment warning ×©×–×” ×œ× ×‘×××ª unique

---

### 12. **scb_** (Separate Changed By)

**××˜×¨×”:** audit fields ×©××ª×¢×“×›× ×™× ×‘× ×¤×¨×“

**×“×•×’××” SQL:**
```sql
scb_ApprovedBy NVARCHAR(100) NULL
```

**×“×•×’××” C#:**
```csharp
/// <summary>
/// User who approved this record (separate audit field).
/// </summary>
[Column("scb_ApprovedBy")]
[MaxLength(100)]
public string ApprovedBySeparate { get; set; }

/// <summary>
/// Date when approval occurred.
/// </summary>
[Column("scb_ApprovedOn")]
public DateTime? ApprovedOnSeparate { get; set; }
```

**×××¤×™×™× ×™×:**
- âœ… Property suffix: `Separate`
- âœ… ×‘×“×¨×š ×›×œ×œ ×‘×–×•×’×•×ª (By + On)

---

## ğŸ”— Relationships - Navigation Properties

### Foreign Key Detection:

```csharp
// Column: CustomerID INT (FK to Customer.ID)
// Generate:

/// <summary>
/// Foreign key to Customer table.
/// </summary>
[ForeignKey(nameof(Customer))]
public int? CustomerID { get; set; }

/// <summary>
/// Navigation property to Customer.
/// </summary>
public virtual Customer Customer { get; set; }
```

### One-to-Many (Parent â†’ Children):

```csharp
// Customer has many Orders
// In Customer.cs:

/// <summary>
/// Navigation property to Orders collection.
/// </summary>
public virtual ICollection<Order> Orders { get; set; } = new List<Order>();
```

### Many-to-One (Child â†’ Parent):

```csharp
// Order belongs to Customer
// In Order.cs:

/// <summary>
/// Foreign key to Customer.
/// </summary>
[ForeignKey(nameof(Customer))]
public int CustomerID { get; set; }

/// <summary>
/// Navigation property to Customer.
/// </summary>
public virtual Customer Customer { get; set; }
```

### One-to-One:

```csharp
// Customer has one CustomerDetail
// In Customer.cs:

/// <summary>
/// Navigation property to CustomerDetail (one-to-one).
/// </summary>
public virtual CustomerDetail Detail { get; set; }

// In CustomerDetail.cs:

[ForeignKey(nameof(Customer))]
public int CustomerID { get; set; }

public virtual Customer Customer { get; set; }
```

---

## ğŸ—ï¸ Audit Columns

### Standard Audit Fields:

```csharp
/// <summary>
/// Date and time when the record was created.
/// </summary>
[Column("AddedOn")]
[Required]
[DatabaseGenerated(DatabaseGeneratedOption.Identity)]
public DateTime AddedOn { get; private set; } = DateTime.Now;

/// <summary>
/// User who created the record.
/// </summary>
[Column("AddedBy")]
[Required]
[MaxLength(100)]
public string AddedBy { get; private set; }

/// <summary>
/// Date and time of last modification.
/// </summary>
[Column("ChangedOn")]
[DatabaseGenerated(DatabaseGeneratedOption.Computed)]
public DateTime? ChangedOn { get; private set; }

/// <summary>
/// User who last modified the record.
/// </summary>
[Column("ChangedBy")]
[MaxLength(100)]
public string ChangedBy { get; private set; }
```

**×××¤×™×™× ×™×:**
- âœ… `private set` - ×œ× × ×™×ª× ×™× ×œ×©×™× ×•×™ ×™×“× ×™
- âœ… AddedOn: `[DatabaseGenerated(Identity)]`
- âœ… ChangedOn: `[DatabaseGenerated(Computed)]`

---

## ğŸ¯ Attributes - Validation & Metadata

### Data Annotations:

```csharp
[Table("Customer")] // Table name
[Column("Name")] // Column name
[Key] // Primary key
[Required] // NOT NULL
[MaxLength(100)] // Length constraint
[StringLength(100, MinimumLength = 3)] // Min/Max
[Range(0, 999)] // Numeric range
[EmailAddress] // Email validation
[Phone] // Phone validation
[Url] // URL validation
[RegularExpression(@"^\d{5}$")] // Regex
[DatabaseGenerated(DatabaseGeneratedOption.Identity)] // IDENTITY
[DatabaseGenerated(DatabaseGeneratedOption.Computed)] // Computed
[ForeignKey("CustomerID")] // FK relationship
[NotMapped] // Ignore in DB
[JsonIgnore] // Ignore in JSON serialization
[Display(Name = "Customer Name")] // Display name
```

### ×“×•×’××” ××œ××”:

```csharp
[Table("Customer")]
public partial class Customer
{
    [Key]
    [Column("ID")]
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public int ID { get; set; }
    
    [Required(ErrorMessage = "Name is required")]
    [Column("Name")]
    [MaxLength(100)]
    [Display(Name = "Customer Name")]
    public string Name { get; set; }
    
    [Column("Email")]
    [MaxLength(100)]
    [EmailAddress(ErrorMessage = "Invalid email format")]
    public string Email { get; set; }
    
    [Column("Age")]
    [Range(18, 120, ErrorMessage = "Age must be between 18 and 120")]
    public int? Age { get; set; }
}
```

---

## ğŸ”¨ Methods

### 1. Constructor:

```csharp
/// <summary>
/// Initializes a new instance of the <see cref="Customer"/> class.
/// </summary>
public Customer()
{
    // Initialize collections
    this.Orders = new List<Order>();
    this.Addresses = new List<Address>();
    
    // Set default values
    this.AddedOn = DateTime.Now;
    this.IsActive = true;
}
```

### 2. ToString():

```csharp
/// <summary>
/// Returns a string representation of this Customer.
/// </summary>
public override string ToString()
{
    return $"Customer #{ID}: {Name} ({Email})";
}
```

### 3. Clone():

```csharp
/// <summary>
/// Creates a deep copy of this Customer.
/// </summary>
public Customer Clone()
{
    return new Customer
    {
        // Copy all properties except ID and audit fields
        Name = this.Name,
        Email = this.Email,
        Phone = this.Phone,
        // Collections are NOT cloned (shallow copy)
    };
}
```

### 4. Equals() & GetHashCode():

```csharp
/// <summary>
/// Determines whether the specified object is equal to this Customer.
/// </summary>
public override bool Equals(object obj)
{
    if (obj is not Customer other)
        return false;
    
    // Compare by ID if both have IDs
    if (this.ID > 0 && other.ID > 0)
        return this.ID == other.ID;
    
    // Otherwise compare by unique fields
    return this.Email == other.Email;
}

/// <summary>
/// Returns a hash code for this Customer.
/// </summary>
public override int GetHashCode()
{
    return this.ID > 0 ? this.ID.GetHashCode() : this.Email?.GetHashCode() ?? 0;
}
```

---

## ğŸ“„ ×“×•×’××” ××œ××” - Customer Entity

```csharp
// <auto-generated>
//     This code was generated by TargCC.Core.Generators v2.0.
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
//     Generated: 2025-11-17 20:30:00
// </auto-generated>

using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using Newtonsoft.Json;

namespace MyApp.Entities
{
    /// <summary>
    /// Entity class for Customer table.
    /// Represents a customer in the system.
    /// </summary>
    [Table("Customer")]
    public partial class Customer
    {
        #region Properties - Primary Key
        
        /// <summary>
        /// Primary key identifier.
        /// </summary>
        [Key]
        [Column("ID")]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public int ID { get; set; }
        
        #endregion
        
        #region Properties - Regular Columns
        
        /// <summary>
        /// Customer name.
        /// </summary>
        [Required(ErrorMessage = "Name is required")]
        [Column("Name")]
        [MaxLength(100)]
        [Display(Name = "Customer Name")]
        public string Name { get; set; }
        
        /// <summary>
        /// Customer email address.
        /// </summary>
        [Column("Email")]
        [MaxLength(100)]
        [EmailAddress(ErrorMessage = "Invalid email format")]
        public string Email { get; set; }
        
        /// <summary>
        /// Customer phone number.
        /// </summary>
        [Column("Phone")]
        [MaxLength(20)]
        [Phone]
        public string Phone { get; set; }
        
        #endregion
        
        #region Properties - Prefixed Columns
        
        private string _creditCardEncrypted;
        
        /// <summary>
        /// Hashed password (one-way encryption).
        /// </summary>
        [Column("eno_Password")]
        [Required]
        [MaxLength(64)]
        [JsonIgnore]
        public string PasswordHashed { get; private set; }
        
        /// <summary>
        /// Credit card number (two-way encrypted).
        /// </summary>
        [Column("ent_CreditCard")]
        [MaxLength(int.MaxValue)]
        [JsonIgnore]
        public string CreditCard
        {
            get => DecryptValue(_creditCardEncrypted);
            set => _creditCardEncrypted = EncryptValue(value);
        }
        
        /// <summary>
        /// Status lookup value.
        /// </summary>
        [Column("lkp_Status")]
        [MaxLength(50)]
        public string Status { get; set; }
        
        /// <summary>
        /// Status display text (from lookup table).
        /// </summary>
        [NotMapped]
        public string StatusText { get; set; }
        
        /// <summary>
        /// Calculated age from birth date.
        /// </summary>
        [Column("clc_Age")]
        [DatabaseGenerated(DatabaseGeneratedOption.Computed)]
        public int? AgeCalculated { get; private set; }
        
        /// <summary>
        /// Credit score (business logic field).
        /// </summary>
        [Column("blg_CreditScore")]
        public int? CreditScore { get; internal set; }
        
        /// <summary>
        /// Order count aggregate.
        /// </summary>
        [Column("agg_OrderCount")]
        public int OrderCountAggregate { get; internal set; }
        
        #endregion
        
        #region Properties - Audit Columns
        
        /// <summary>
        /// Date when record was created.
        /// </summary>
        [Column("AddedOn")]
        [Required]
        [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
        public DateTime AddedOn { get; private set; } = DateTime.Now;
        
        /// <summary>
        /// User who created the record.
        /// </summary>
        [Column("AddedBy")]
        [Required]
        [MaxLength(100)]
        public string AddedBy { get; private set; }
        
        /// <summary>
        /// Date of last modification.
        /// </summary>
        [Column("ChangedOn")]
        [DatabaseGenerated(DatabaseGeneratedOption.Computed)]
        public DateTime? ChangedOn { get; private set; }
        
        /// <summary>
        /// User who last modified the record.
        /// </summary>
        [Column("ChangedBy")]
        [MaxLength(100)]
        public string ChangedBy { get; private set; }
        
        #endregion
        
        #region Relationships
        
        /// <summary>
        /// Navigation property to Orders collection.
        /// </summary>
        public virtual ICollection<Order> Orders { get; set; }
        
        /// <summary>
        /// Navigation property to Addresses collection.
        /// </summary>
        public virtual ICollection<Address> Addresses { get; set; }
        
        #endregion
        
        #region Constructors
        
        /// <summary>
        /// Initializes a new instance of the <see cref="Customer"/> class.
        /// </summary>
        public Customer()
        {
            this.Orders = new List<Order>();
            this.Addresses = new List<Address>();
            this.AddedOn = DateTime.Now;
            this.OrderCountAggregate = 0;
        }
        
        #endregion
        
        #region Methods
        
        /// <summary>
        /// Sets the password (will be hashed before saving).
        /// </summary>
        public void SetPassword(string plainTextPassword)
        {
            if (string.IsNullOrEmpty(plainTextPassword))
                throw new ArgumentNullException(nameof(plainTextPassword));
            
            this.PasswordHashed = $"[PleaseHash]{plainTextPassword}";
        }
        
        /// <summary>
        /// Returns a string representation of this Customer.
        /// </summary>
        public override string ToString()
        {
            return $"Customer #{ID}: {Name} ({Email})";
        }
        
        /// <summary>
        /// Creates a shallow copy of this Customer.
        /// </summary>
        public Customer Clone()
        {
            return new Customer
            {
                Name = this.Name,
                Email = this.Email,
                Phone = this.Phone,
                Status = this.Status,
            };
        }
        
        /// <summary>
        /// Determines whether the specified object is equal to this Customer.
        /// </summary>
        public override bool Equals(object obj)
        {
            if (obj is not Customer other)
                return false;
            
            if (this.ID > 0 && other.ID > 0)
                return this.ID == other.ID;
            
            return this.Email == other.Email;
        }
        
        /// <summary>
        /// Returns a hash code for this Customer.
        /// </summary>
        public override int GetHashCode()
        {
            return this.ID > 0 ? this.ID.GetHashCode() : this.Email?.GetHashCode() ?? 0;
        }
        
        #endregion
        
        #region Helper Methods (Private)
        
        private string EncryptValue(string plainText) =>
            string.IsNullOrEmpty(plainText) ? null : $"[PleaseEncrypt]{plainText}";
        
        private string DecryptValue(string encrypted) =>
            string.IsNullOrEmpty(encrypted) ? null : $"[PleaseDecrypt]{encrypted}";
        
        #endregion
    }
}
```

---

## ğŸ§ª Edge Cases & Special Scenarios

### 1. Composite Primary Keys:

```csharp
[Table("OrderDetail")]
public partial class OrderDetail
{
    [Key]
    [Column("OrderID", Order = 0)]
    public int OrderID { get; set; }
    
    [Key]
    [Column("ProductID", Order = 1)]
    public int ProductID { get; set; }
    
    // Override GetHashCode for composite key
    public override int GetHashCode()
    {
        return HashCode.Combine(OrderID, ProductID);
    }
}
```

### 2. Tables ×œ×œ× Primary Key:

```csharp
// Log ×©×’×™××” ××• ××–×”×¨×”
_logger.LogWarning($"Table '{table.Name}' has no primary key. Entity may have limitations.");

// ×™×¦×™×¨×ª entity ×‘×œ×™ [Key] attribute
// ××‘×œ ×¢× ×”×¢×¨×” ×‘×ª×™×¢×•×“
```

### 3. Circular References:

```csharp
// Customer â†’ Orders â†’ Customer
// ×¤×ª×¨×•×Ÿ: ×”×©×ª××© ×‘-virtual properties

public virtual ICollection<Order> Orders { get; set; }

// ×‘-JSON serialization:
[JsonIgnore] // ×¢×œ ××—×“ ××”×¦×“×“×™× ×›×“×™ ×œ×× ×•×¢ loop
```

### 4. Reserved C# Keywords:

```csharp
// Column name: "Class"
// Solution: Add @ prefix

[Column("Class")]
public string @Class { get; set; }
```

### 5. Very Long Column Names (> 100 chars):

```csharp
// Truncate or abbreviate
private string ShortenPropertyName(string columnName)
{
    if (columnName.Length <= 100)
        return columnName;
    
    // Keep first 80 chars + hash of full name
    var hash = columnName.GetHashCode().ToString("X");
    return $"{columnName.Substring(0, 80)}_{hash}";
}
```

---

## âœ… Validation Rules

### Required Fields:
- âœ… NOT NULL columns â†’ `[Required]`
- âœ… Primary keys â†’ `[Required]`
- âœ… AddedOn, AddedBy â†’ `[Required]`

### String Lengths:
- âœ… VARCHAR(n), NVARCHAR(n) â†’ `[MaxLength(n)]`
- âœ… VARCHAR(MAX) â†’ `[MaxLength(int.MaxValue)]`
- âœ… TEXT â†’ `[MaxLength(int.MaxValue)]`

### Numeric Ranges:
- âœ… TINYINT â†’ `[Range(0, 255)]`
- âœ… SMALLINT â†’ `[Range(-32768, 32767)]`
- âœ… Age fields â†’ `[Range(0, 150)]` (custom)

### Format Validation:
- âœ… Email columns â†’ `[EmailAddress]`
- âœ… Phone columns â†’ `[Phone]`
- âœ… URL columns â†’ `[Url]`

---

## ğŸ“Š Testing Strategy

### Unit Tests (35+):

1. **TypeMapper Tests (10)**
   - All SQL types â†’ C# types
   - Nullable handling
   - Default values

2. **PrefixHandler Tests (12)**
   - Each prefix type
   - Property naming
   - Attributes

3. **PropertyGenerator Tests (8)**
   - Regular properties
   - Complex types
   - Validation attributes

4. **RelationshipGenerator Tests (5)**
   - One-to-Many
   - Many-to-One
   - One-to-One
   - Composite keys

5. **Integration Tests (5)**
   - Full entity generation
   - Multiple tables
   - Edge cases

---

## ğŸ¯ Success Criteria

- âœ… ×™×•×¦×¨ entity ××œ× ×¢× ×›×œ ×”-properties
- âœ… ××˜×¤×œ ×‘-12 ×¡×•×’×™ ×”×¤×¨×™×¤×™×§×¡×™× × ×›×•×Ÿ
- âœ… ×™×•×¦×¨ relationships × ×›×•× ×™×
- âœ… Validation attributes ××ª××™××™×
- âœ… Code compiles ×œ×œ× ×©×’×™××•×ª
- âœ… 80%+ test coverage
- âœ… SonarQube Grade A
- âœ… XML documentation ××œ×

---

## ğŸ“ Implementation Order

**Week 1 (Days 1-2): Core**
1. TypeMapper
2. PropertyGenerator (basic)
3. EntityGenerator (structure)

**Week 1 (Days 3-4): Prefixes**
4. PrefixHandler (all 12 types)
5. Special property handling

**Week 1 (Day 5): Relationships**
6. RelationshipGenerator
7. Navigation properties

**Week 2 (Days 1-2): Methods & Polish**
8. MethodGenerator
9. AttributeGenerator
10. XML documentation

**Week 2 (Days 3-5): Testing**
11. Unit tests
12. Integration tests
13. Documentation

---

**×¡×˜×˜×•×¡:** âœ… ××•×›×Ÿ ×œ×”×ª×—×œ×”!  
**×”×‘×:** ×”×ª×—×œ×ª ×”×§×•×“ - TypeMapper.cs
